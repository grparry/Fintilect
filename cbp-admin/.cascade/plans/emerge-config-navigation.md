# Emerge Config Navigation Design

## Overview
Design for integrating configuration sections into the existing navigation system while maintaining type safety and code generation capabilities.

## Current System
- Uses `NavigationItem` interface for menu items
- Supports nested navigation with children
- Handles permissions and badges
- Uses React Router for routing

## Navigation Structure

### 1. Route Configuration
```typescript
// src/routes/emerge-config.routes.ts
import { lazy } from 'react';
import { RouteConfig } from '../types/route.types';

export const emergeConfigRoutes: RouteConfig[] = [
    {
        path: '/admin/emerge-config',
        element: lazy(() => import('../components/emerge-config/EmergeConfigLanding')),
        children: [
            {
                path: ':groupId/:sectionId',
                element: lazy(() => import('../components/emerge-config/ConfigSectionWrapper'))
            }
        ]
    }
];
```

### 2. Section Registry
```typescript
// src/components/emerge-config/registry/ConfigSectionRegistry.ts
export class ConfigSectionRegistry {
    private static sections = new Map<string, typeof EmergeConfigSection>();
    
    static register(key: string, section: typeof EmergeConfigSection) {
        this.sections.set(key, section);
    }
    
    static getSection(groupId: string, sectionId: string): typeof EmergeConfigSection | undefined {
        return this.sections.get(`${groupId}.${sectionId}`);
    }
    
    static getNavigationItems(): NavigationItem[] {
        return Array.from(this.sections.values()).map(section => ({
            id: section.metadata.key,
            title: section.metadata.label,
            path: `/admin/emerge-config/${section.metadata.groupId}/${section.metadata.sectionId}`,
            icon: section.metadata.icon
        }));
    }
}
```

### 3. Section Wrapper
```typescript
// src/components/emerge-config/ConfigSectionWrapper.tsx
export const ConfigSectionWrapper: React.FC = () => {
    const { groupId, sectionId } = useParams();
    const Section = ConfigSectionRegistry.getSection(groupId, sectionId);
    
    if (!Section) {
        return <NotFound />;
    }
    
    return <Section />;
};
```

### 4. Generated Navigation
```typescript
// Generated by legacy-analyzer
export class AccountCategoriesSection extends EmergeConfigSection<AccountConfig> {
    static metadata: ConfigMetadata = {
        key: 'Account.Categories',
        groupId: 'accounts',  // For URL
        sectionId: 'categories',  // For URL
        label: 'Account Categories',
        icon: AccountBalanceIcon,
        category: 'Account Management'
    };
    
    static {
        // Auto-register with navigation
        ConfigSectionRegistry.register('accounts.categories', AccountCategoriesSection);
    }
}
```

## URL Structure
- Base: `/admin/emerge-config`
- Landing: `/admin/emerge-config`
- Section: `/admin/emerge-config/:groupId/:sectionId`
- Example: `/admin/emerge-config/accounts/categories`

## Integration Points

### 1. Navigation Context
```typescript
// src/context/NavigationContext.tsx
export interface ConfigNavigationState {
    activeGroup: string | null;
    activeSection: string | null;
}

export const ConfigNavigationProvider: React.FC = ({ children }) => {
    const [state, setState] = useState<ConfigNavigationState>({
        activeGroup: null,
        activeSection: null
    });
    
    // Navigation logic
};
```

### 2. Menu Integration
```typescript
// src/components/navigation/ConfigNavigation.tsx
export const ConfigNavigation: React.FC = () => {
    const items = ConfigSectionRegistry.getNavigationItems();
    
    return (
        <NavigationContent 
            items={items}
            basePath="/admin/emerge-config"
        />
    );
};
```

## Code Generation

### 1. Navigation Metadata
Generated in section files:
```typescript
// Generated navigation metadata
static navigationMetadata = {
    groupId: 'accounts',
    sectionId: 'categories',
    menuPath: ['Account Management', 'Categories'],
    icon: AccountBalanceIcon,
    permissions: ['config.account.read']
};
```

### 2. Route Registration
Auto-generated route configuration:
```typescript
// Generated in routes/index.ts
export const generatedRoutes = [
    {
        path: '/admin/emerge-config/accounts/categories',
        element: lazy(() => import('../sections/accounts/AccountCategoriesSection')),
        navigationMetadata: AccountCategoriesSection.navigationMetadata
    }
];
```

## Implementation Steps

1. **Base Infrastructure**
   - Create ConfigSectionWrapper
   - Implement ConfigSectionRegistry
   - Add navigation context

2. **Code Generation**
   - Add navigation metadata generation
   - Generate route configurations
   - Add auto-registration

3. **Integration**
   - Hook into existing navigation
   - Add permission handling
   - Implement breadcrumbs
   - Add loading states

4. **Testing**
   - Test route generation
   - Verify navigation state
   - Test section loading
   - Validate permissions
