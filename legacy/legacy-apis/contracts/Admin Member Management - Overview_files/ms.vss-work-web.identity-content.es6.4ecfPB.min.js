"use strict";define("Wit/Identity",["require","exports","VSS/Core/Util/String","VSS/Platform/Identity","VSS/Platform/Location"],(function(e,t,i,n,r){var I,E,a;I=t[a="ConstantsConstants"]={},(E=t[a].SubjectType||(t[a].SubjectType={})).AadUser="aad",E.AadGroup="aadgp",E.AadServicePrincipal="aadsp",t.InterfacesWorkItemInterfaces={},function(e){t[e]={};let E={},a={},s={};function d(n){var r;if(!n)return"";var I="",E=n.lastIndexOf(t[e].IDENTITY_UNIQUENAME_SEPARATOR);if(r=-1===E?n:n.substr(0,E),i.startsWith(r,t[e].TFS_GROUP_PREFIX)){var a=r.substr(3).trim();I=i.isGuid(a)?a:""}return I}function N(n){if(!n)return null;var r=n.lastIndexOf(t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START),I=n.lastIndexOf(t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END),E=!1,a=!1,s=!1,N=n;r>=0&&I>r&&(s=!0,N=N.replace(t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START).replace(t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END)),r=N.lastIndexOf(t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START),I=N.lastIndexOf(t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END);var o=N,T="",R="";let u="";var _,A="";if(r>=0&&I>r)if(o=N.substr(0,r).trim(),s){0===(A=N.substr(r+1,I-r-1).trim()).indexOf(t[e].AAD_IDENTITY_USER_PREFIX)?A=A.substr(t[e].AAD_IDENTITY_USER_PREFIX.length):0===A.indexOf(t[e].AAD_IDENTITY_GROUP_PREFIX)&&(E=!0,A=A.substr(t[e].AAD_IDENTITY_GROUP_PREFIX.length));var l=A.lastIndexOf("\\");l>0&&(-1!==(R=A.substr(l+1).trim()).indexOf("@")?(T=R,A=A.substr(0,l).trim()):(o=n,A="",s=!1,E=!1))}else{var D=d(R=N.substr(r+1,I-r-1).trim());u=(_=R)?0!=_.indexOf(t[e].DESCRIPTOR_PREFIX)?"":_.replace(/desc:/i,""):"",-1!==R.indexOf("@")||-1!==R.indexOf("\\")||-1!==R.indexOf(t[e].DESCRIPTOR_PREFIX)||D||i.isGuid(R)?(T=R,""!=D&&(A=D,E=!0,a=!0,T="")):o=n}return{id:null!=A?A:o,displayName:o,uniqueName:u||T||o,isAadIdentity:s,isContainer:E,isTfsGroup:a}}function o(e,t,i){var n;const r=T(t),I=R(t);if(i&&!r&&!I)return u(e,t);if(r){const e=t;return i?e.identityRef:e.distinctDisplayName||e.identityRef.displayName}if(I){const e=t;return e.uniqueName=null!==(n=e.uniqueName)&&void 0!==n?n:e.displayName,i?e:e.displayName}return t}function T(e){if(e&&void 0!==e.identityRef){const t=e;return t.distinctDisplayName&&!E[t.distinctDisplayName]&&(t.identityRef&&!t.identityRef.uniqueName&&(t.identityRef.uniqueName=t.identityRef.displayName),E[t.distinctDisplayName]=t),t.identityRef&&t.identityRef.descriptor&&!a[t.identityRef.descriptor]&&(a[t.identityRef.descriptor]=t),!0}return!1}function R(e){return!(!e||void 0===e.displayName)}function u(e,t,i){if(E[t])return E[t].identityRef;const n=N(t),r=e.getService("IVssIdentityService");return i=i||r.getIdentityImageUrl(n?n.id:""),n&&n.isAadIdentity?{displayName:t}:n&&{displayName:n.displayName,uniqueName:n.uniqueName,imageUrl:i,_links:{avatar:{href:i}}}}function _(e){let t=Object.assign({},e);return e.identityRef.displayName&&(t.identityRef.displayName=N(t.identityRef.displayName).displayName),t}function A(n,r){return n&&r?i.format("{0} {1}{2}{3}",n,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,r,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END):""}function l(n,r){return n&&r?i.format("{0} {1}{2}{3}{4}",n,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,t[e].TFS_GROUP_PREFIX,r,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END):""}function D(n){if(!n)return"";const r=n.signInAddress||n.samAccountName||n.mail||n.originId;if(y(n)){const r=i.equals(n.entityType,"Group",!0),I=r?t[e].AAD_IDENTITY_GROUP_PREFIX:t[e].AAD_IDENTITY_USER_PREFIX;return!n.signInAddress&&!n.mail||r?i.format("{0} {1}{2}{3}{4}",n.displayName,t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,I,n.originId,t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END):i.format("{0} {1}{2}{3}\\{4}{5}",n.displayName,t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,I,n.originId,n.signInAddress||n.mail,t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END)}return function(e){const t=e.displayName.indexOf("\\");return i.equals(e.entityType,"Group",!0)&&i.startsWith(e.displayName,"[")&&-1!==t&&i.endsWith(e.displayName.substring(0,t),"]")}(n)?n.localId?i.format("{0} {1}{2}{3}{4}",n.displayName,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,t[e].TFS_GROUP_PREFIX,n.localId.toUpperCase(),t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END):n.displayName:r?-1===r.indexOf("@")&&n.scopeName&&!n.subjectDescriptor.startsWith(I.SubjectType.AadServicePrincipal)?i.format("{0} {1}{2}\\{3}{4}",n.displayName,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,n.scopeName,r,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END):i.format("{0} {1}{2}{3}",n.displayName,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,r,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END):n.subjectDescriptor?i.format("{0} {1}{2}{3}{4}",n.displayName,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,t[e].DESCRIPTOR_PREFIX,n.subjectDescriptor,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END):n.displayName||""}function c(e,t,i){const n=D(t),r=u(e,n,i);return void 0===r.id&&void 0!==(null==t?void 0:t.localId)&&(r.id=t.localId),void 0===r.descriptor&&void 0!==(null==t?void 0:t.subjectDescriptor)&&(r.descriptor=t.subjectDescriptor),{distinctDisplayName:n,identityRef:r}}function m(e,t){const i=e.getService("IVssIdentityService").getIdentityImageUrl(t);return{displayName:t.displayName,entityId:t.id,entityType:"User",image:i}}function y(e){return i.equals(e.originDirectory,"aad",!0)&&e.originId&&!e.localId}t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START="<",t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END=">",t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START="<<",t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END=">>",t[e].TFS_GROUP_PREFIX="id:",t[e].AAD_IDENTITY_USER_PREFIX="user:",t[e].AAD_IDENTITY_GROUP_PREFIX="group:",t[e].IDENTITY_UNIQUENAME_SEPARATOR="\\",t[e].DESCRIPTOR_PREFIX="desc:",t[e].getVsIdFromGroupUniqueName=d,t[e].parseUniquefiedIdentityName=N,t[e].setResolvedByDescriptorIfWorkItemIdentityRef=function(e){T(e)&&e.identityRef&&e.identityRef.descriptor&&(s[e.identityRef.descriptor]=!0)},t[e].convertPotentialIdentityRefFromFieldValue=o,t[e].convertPotentialIdentityRefFromFieldValueNotAsIdentityRef=function(e){return T(e)?e.distinctDisplayName||e.identityRef.displayName:R(e)?e.displayName:e},t[e].isWorkItemIdentityRef=T,t[e].isIdentityRef=R,t[e].createIdentityRefFromDistinctDisplayName=u,t[e].convertWorkItemIdentityRefFromFieldValue=function(e,t){var i;if(T(t))return _(t);if(function(e){const t=e&&"string"==typeof e.displayName&&void 0!==e.entityId;return t}(t)){return _(c(e,t,t.image))}let n=o(e,t,!0);return n||(n={displayName:t}),_({distinctDisplayName:null!==(i=n.displayName)&&void 0!==i?i:t,identityRef:n})},t[e].uniqueSortWorkItemIdentityRefObjects=function(e){if(!e||0===e.length)return e;const t={};return e.forEach((e=>t[e.distinctDisplayName]=e)),Object.keys(t).sort(i.localeIgnoreCaseComparer).map((e=>t[e]))},t[e].getFriendlyDistinctDisplayName=function(e){return e.displayName&&e.uniqueName&&!e.isTfsGroup?e.isContainer?l(e.displayName,e.id):A(e.displayName,e.uniqueName):e.displayName||""},t[e].getDistinctDisplayName=A,t[e].getDistinctGroupDisplayName=l,t[e].getUniquefiedIdentityName=D,t[e].convertIIdentityToWorkItemIdentityRef=c,t[e].convertWorkItemIdentityRefToIIdentity=function(e,t){const i=null==t?void 0:t.identityRef;if(i)return m(e,i)},t[e].convertIdentityRefToIIdentity=m,t[e].getIIdentityObject=function(e,t,I){if(!t)return;const E="@me";if(0===(0,i.localeIgnoreCaseComparer)(t,E))return{displayName:E,entityId:E,entityType:"User",originDirectory:"",originId:"",image:(0,r.getAssetLocation)(e,"ms.vss-work-web/common-content/Content/memacro-user.svg")};const a=t.substring(0,t.indexOf("<")).trim(),s=-1!==t.indexOf("<id:");let d;return d=s?t.substring(t.indexOf(":")+1,t.length-1).trim():t.substring(t.indexOf("<")+1,t.length-1).trim(),{displayName:a,entityId:null!=I?I:"",entityType:s?"Group":"User",localId:s?d:"",mail:s?"":d,originId:s?d:"",samAccountName:s?"":d,signInAddress:s?"":d,image:(0,n.getIdentityImageUrl)(e,u(e,t))}};const f=/.*\<[0-9\-\@a-f]+\>$/i;t[e].stripIdPartFromDisplayName=function(e){return f.test(e)?e.substr(0,e.lastIndexOf("<")).trim():e},t[e].isAADGroupIdentity=function(e){return!!e&&(y(e)&&i.equals(e.entityType,"Group",!0))},t[e].getAADGroupName=function(n){return n.displayName&&n.originId?i.format("{0} {1}{2}{3}{4}",n.displayName,t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,t[e].AAD_IDENTITY_GROUP_PREFIX,n.originId,t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END):""}}("UtilitiesWorkItemIdentityHelper")}),["Constants/Constants","Interfaces/WorkItemInterfaces","Utilities/WorkItemIdentityHelper"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-work-web.identity-content"}}));