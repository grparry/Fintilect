"use strict";define("Wiki/PageTree",["require","exports","VSSUI/Table","react","VSS/Core/Util/Object","VSS/Platform/Layout","Wiki/ViewCommon/Utils/WikiHelper","VSS/Core/Util/String","VSSUI/Utilities/TreeItemProvider","Wiki/ViewCommon/Utils/PathHelper","VSS/Platform/FPS","VSS/Platform/Context","VSS/Core/Observable","VSSUI/Icon","VSSUI/List","VSSUI/Status","VSSUI/TooltipEx","VSSUI/TreeEx","VSSUI/Util","VSSUI/Utilities/Selection","VSSUI/FilterBar","VSSUI/Spinner","VSSUI/TextFilterBarItem","VSSUI/Utilities/Filter","VSS/Core/Util/Accessibility","VSS/Reflux/Store"],(function(e,t,r,s,i,a,o,n,l,d,h,p,g,c,m,u,_,I,P,T,f,v,S,b,D,C){var N,k,x,F,E,w;N=t[w="Resources"]={},t[w].FilterTreeWatermarkText="Filter pages by title",t[w].FilteredTree_NoResultsFound="No results found",t[w].NoResultFound="No results found",t[w].OneResultFound="1 result found",t[w].NResultsFound="{0} results found",t[w].SearchAriaLabel="Wiki",t[w].WikiPageTreeAriaLabel="{0} Wiki Tree Navigation.",t[w].FilterPagePlaceholder="Enter page title",function(e){t[e]={};class s extends r.ColumnMore{constructor(e,t){super((t=>e(t.underlyingItem.data)),(e=>t(e.underlyingItem.data)))}}t[e].TreeMoreColumn=s}("ComponentsTreeMoreColumn"),function(e){k=t[e]={};class r extends a.VssComponent{constructor(e,t){super(e),this._onDragStart=e=>{if(this.props.canDrag){e.dataTransfer.effectAllowed="all",this.props.onDrag(this.props.item);const t={source:"WikiTreeNode",text:this.props.dataTransferValue};e.dataTransfer.setData("text",JSON.stringify(t))}},this._onReparentDragEnter=e=>{this._isDragOperationSupported(e)&&(this._stop(e),this.setState({isOverReparentTarget:!0}))},this._onReparentDragExit=e=>{this._isDragOperationSupported(e)&&(this._stop(e),this.setState({isOverReparentTarget:!1}))},this._onReparentDrop=e=>{this._isDragOperationSupported(e)&&(this._stop(e),this.setState({isOverReparentTarget:!1}),this.props.onDrop(this.props.item))},this._onReorderDragEnter=e=>{const t=this._isTopReorderTargetEvent(e);this._isDragOperationSupported(e,!0)&&(this._stop(e),t?this.setState({isOverTopReorderTarget:!0}):this.setState({isOverBottomReorderTarget:!0}))},this._onReorderDragExit=e=>{const t=this._isTopReorderTargetEvent(e);this._isDragOperationSupported(e,!0)&&(this._stop(e),t?this.setState({isOverTopReorderTarget:!1}):this.setState({isOverBottomReorderTarget:!1}))},this._onReorderDrop=e=>{const t=this._isTopReorderTargetEvent(e);this._isDragOperationSupported(e,!0)&&(this._stop(e),t?this.setState({isOverTopReorderTarget:!1}):this.setState({isOverBottomReorderTarget:!1}),this.props.onDrop(this.props.item,!0,t))},this.state={};const r=(0,i.getId)();this._topReorderTargetId="top-reorder-target-"+r,this._bottomReorderTargetId="bottom-reorder-target-"+r}render(){const e="dragging";return s.createElement("div",{className:(0,a.css)("tree-node-draggable",this.props.className)},s.createElement("div",{className:(0,a.css)("reparent-target",this.state.isOverReparentTarget?e:""),draggable:this.props.canDrag,onDragStart:this._onDragStart,onDragEnter:this._onReparentDragEnter,onDragOver:this._onReparentDragEnter,onDragLeave:this._onReparentDragExit,onDrop:this._onReparentDrop},this.props.children),s.createElement("div",{id:this._topReorderTargetId,className:(0,a.css)("top-target",this.state.isOverTopReorderTarget?e:""),onDragEnter:this._onReorderDragEnter,onDragOver:this._onReorderDragEnter,onDragLeave:this._onReorderDragExit,onDrop:this._onReorderDrop}),s.createElement("div",{id:this._bottomReorderTargetId,className:(0,a.css)("bottom-target",this.state.isOverBottomReorderTarget?e:""),onDragEnter:this._onReorderDragEnter,onDragOver:this._onReorderDragEnter,onDragLeave:this._onReorderDragExit,onDrop:this._onReorderDrop}))}_stop(e){e.preventDefault(),e.stopPropagation()}_isDragOperationSupported(e,t){const r=e.dataTransfer.effectAllowed,s=(0,o.isSafari)()?!!r&&"none"!==r:"all"===r,i=this.props.canDrop(this.props.item,t);return s&&i&&this.props.canDrag}_isTopReorderTargetEvent(e){return e.target.id===this._topReorderTargetId}}t[e].TreeNodeDraggable=r}("ComponentsTreeNodeDraggable"),function(e){function r(e){let t,r;return e&&(t=e.lastIndexOf("/"),t>=0)?(r=e.substr(0,t),""===r?"/":r):""}x=t[e]={},t[e].getParentPaths=function(e){const t=[];if(e.trim()){let s=e,i=r(s);for(;s!==i;)t.push(i),s=i,i=r(s)}return t.reverse()}}("Helper"),function(e){F=t[e]={};class r extends l.TreeItemProvider{constructor(e,t){super([]),this._allTreeItems={},this._wikiPathIgnoreCaseToPageMap={},this.getItemFromTree=e=>{const t=this._allTreeItems[e];if(t)return Object.assign({},t.data)},this.prepareNextPageToSelect=e=>(this.expandParentHierarchy(e),this.getItemIndex(e)),this.getWikiPageForPagePathIgnoreCase=e=>this._wikiPathIgnoreCaseToPageMap[e.toLocaleLowerCase()],e=this._filterHiddenFiles(e);this._treeMapper=new s({hasChildItems:this._hasChildItems,isItemExpanded:e=>t});const r=this._treeMapper.createPageTree(e,this._allTreeItems);this._addWikiPagesToWikiPathIgnoreCaseMap(this._allTreeItems),r.length&&this.splice(void 0,void 0,[{items:r}])}reorderItem(e,t){const r=this._allTreeItems[e];if(!r||r.data.order===t)return;const s=(0,d.getParentPath)(e),i=this._allTreeItems[s],a=this._reorderSiblings(e,r.data.order,t);this.remove(r,i),this.add(r,i,a)}completeExistingItems(e){const t={};e=this._filterHiddenFiles(e),this._treeMapper.createPageTree(e,t);for(const e in this._allTreeItems){const r=this._allTreeItems[e],s=t[e];r&&r.childItems&&0===r.childItems.length&&s&&s.childItems&&this.splice(r,void 0,[{items:s.childItems}])}for(const e in t)void 0===this._allTreeItems[e]?this._addWikiPageTreeItem(e,t[e]):(this._allTreeItems[e].data=t[e].data,this._wikiPathIgnoreCaseToPageMap[e.toLocaleLowerCase()]=t[e].data)}replaceAllItems(e,t){const r=this.value.slice();this.clear(),e=this._filterHiddenFiles(e);const s=this._treeMapper.createPageTree(e,this._allTreeItems);if(this._addWikiPagesToWikiPathIgnoreCaseMap(this._allTreeItems),s.length){if(t)for(const e of r)if(e.underlyingItem.expanded){const t=this._allTreeItems[e.underlyingItem.data.path];t.expanded=!0}this._updateConformancyForPages(),this.splice(void 0,void 0,[{items:s}])}}deletePage(e){if("/"===e)return void this.clear();const t=this._allTreeItems[e];if(!t)return;const r=(0,d.getParentPath)(e),s=this._allTreeItems[r];let i=[];if(t&&"/"===r?this.value.forEach((e=>{e.parentItem||i.push(e.underlyingItem.data)})):s&&t&&(i=s.data.subPages),i.length>0&&(r=>{const s=[],i=t.data.order||0;for(const t of r)t.order=t.order||0,t.path!==e&&(t.order>i&&(t.order=t.order-1),s.push(t))})(i),s){const t=s.data.subPages.filter((t=>t.path!=e));s.data.subPages=t,0===s.data.subPages.length&&(s.data.isParentPage=!1)}const a=this._getAllSubPageList(e);this.splice(s,[t],void 0);for(const e of a)this._removePagePath(e);this._removePagePath(e)}addItem(e){const t=this._allTreeItems[e.path];if(t)t.data=Object.assign(Object.assign({},e),{pageName:(0,d.getFileName)(e.path)}),this._wikiPathIgnoreCaseToPageMap[e.path.toLocaleLowerCase()]=e;else{const t=this._treeMapper.createOneLevelTreeItems([e])[0],r=(0,d.getParentPath)(e.path),s=this._allTreeItems[r];s&&(s.data.isParentPage||(s.data.isParentPage=!0),s.expanded=!0,s.data.subPages.push(e)),this._addWikiPageTreeItem(e.path,t);const i=this._reorderSiblings(e.path,Number.MAX_SAFE_INTEGER,e.order);this.add(t,s,i)}}getNthChild(e,t){let r;if("/"===e)r=this._getRootItems();else{const t=this._allTreeItems[e];t&&(r=t.childItems)}if(r&&r.length>=t){const e=r[t-1];if(e)return e.data}}getFirstConformantChild(e){let t;if("/"===e)t=this._getRootItems();else{const r=this._allTreeItems[e];r&&(t=r.childItems)}if(t){let e,r=0;for(;r<t.length;){if(e=t[r],!e.data.isNonConformant)return e.data;r++}}}getItemIndex(e){const t=this._allTreeItems[e];return t?this._indexOf(t):-1}getItemFromTreeIndex(e){if(!(e<0||e>=this.value.length))return this.value[e].underlyingItem.data}toggleItem(e,t){const r=this._allTreeItems[e];if(r){if(r.data.isNonConformant)return;void 0!==t&&r.expanded===t||this.toggle(r)}}addChildItems(e,t){const r=this._allTreeItems[e];if(t=this._filterHiddenFiles(t),r){const r=this._allTreeItems[e],s=t.filter((e=>!this._allTreeItems[e.path])),i=this._treeMapper.createOneLevelTreeItems(s);for(const e of i)this._addWikiPageTreeItem(e.data.path,e);i&&i.length>0?(r.expanded=!0,r.data.subPages=t,this.splice(r,void 0,[{items:i}])):this.toggle(r)}else 0}expandParentHierarchy(e){const t=(0,x.getParentPaths)(e);for(const e of t)this.toggleItem(e,!0)}getAllPages(){const e=[];for(const t in this._allTreeItems)e.push(this._allTreeItems[t].data);return e}onPageHierarchyReloaded(e,t){const r={};t=this._filterHiddenFiles(t),this._treeMapper.createPageTree(t,r);const s=this._allTreeItems[e],i=this._allTreeItems[(0,d.getParentPath)(e)];for(const e in r)this._addWikiPageTreeItem(e,r[e]);const a=this._reorderSiblings(e,Number.MAX_SAFE_INTEGER,s.data.order);this.remove(s,i),this.add(this._allTreeItems[e],i,a)}renameItem(e,t){this._allTreeItems[e]&&this.moveItem(e,t.path,t.order)}moveItem(e,t,r){const s=this._allTreeItems[e],i=(0,d.getParentPath)(e),a=(this._allTreeItems[i],(0,d.getParentPath)(t)),o=this._allTreeItems[a],n={},l=this._treeMapper.replacePathInHierarchy(s,t,n);l.data.order=r,l.expanded=!1,this.deletePage(e),o&&(o.data.subPages.push(l.data),1===o.data.subPages.length&&(o.data.isParentPage=!0));for(const e in n)this._addWikiPageTreeItem(e,n[e]);const h=this._reorderSiblings(t,Number.MAX_SAFE_INTEGER,r);this.add(l,o,h),this.prepareNextPageToSelect(t)}clear(){super.clear(),this._allTreeItems={},this._wikiPathIgnoreCaseToPageMap={}}getNextSibling(e,t=!0){let r,s=this._getSiblings(e);t||(s=s.reverse());for(const t of s){if(t.data.path===e)return r;r=t.data}}_filterHiddenFiles(e){return e.filter((e=>-1===e.path.indexOf("/.")||0===e.path.indexOf("/.templates")))}_updateConformancyForPages(){for(const e in this._allTreeItems){const t=this._allTreeItems[e].data;t.isNonConformant=this._isPageOrAncestorNonConformant(t)}}_isPageOrAncestorNonConformant(e){if(e.isNonConformant)return!0;let t=!1;return(0,x.getParentPaths)(e.path).every((e=>{const r=this._allTreeItems[e];return t=t||r&&r.data.isNonConformant,!t})),t}_getSiblings(e){const t=this._allTreeItems[e],r=(0,d.getParentPath)(e),s=this._allTreeItems[r];let i=[];return t&&"/"===r?i=this._getRootItems():s&&s.childItems&&(i=s.childItems),i}_reorderSiblings(e,t,r){let s;const i=this._getSiblings(e);if(i.length>0)for(const a of i)a.data.order=a.data.order||0,a.data.path===e?a.data.order=r:t>r&&a.data.order>=r&&a.data.order<t?a.data.order=(0,o.boundedOrderIncrement)(a.data.order):t<r&&a.data.order<=r&&a.data.order>t&&(a.data.order=a.data.order-1),a.data.order===r-1&&(s=a);return s}_hasChildItems(e){return!e||e.isParentPage}_getRootItems(){const e=[];return this.value.forEach((t=>{t.parentItem||e.push(t.underlyingItem)})),e}_indexOf(e,t=0){for(let r=t;r<this.value.length;r++)if(e===this.value[r].underlyingItem)return r;return-1}_getAllSubPageList(e){const t=[];(0,n.endsWith)(e,"/")||(e+="/");for(const r in this._allTreeItems)(0,n.startsWith)(r,e)&&t.push(r);return t}_addWikiPageTreeItem(e,t){this._allTreeItems[e]=t,this._wikiPathIgnoreCaseToPageMap[e.toLocaleLowerCase()]=t.data}_addWikiPagesToWikiPathIgnoreCaseMap(e){for(const t of Object.keys(e))t&&(this._wikiPathIgnoreCaseToPageMap[t.toLocaleLowerCase()]=e[t].data)}_removePagePath(e){delete this._allTreeItems[e],this._wikiPathIgnoreCaseToPageMap[e.toLocaleLowerCase()]&&delete this._wikiPathIgnoreCaseToPageMap[e.toLocaleLowerCase()]}}t[e].WikiPageTreeItemProvider=r;class s{constructor(e){this._options=e}createPageTree(e,t){const r=new i(""),s={};for(const t of e){const e=Object.assign(Object.assign({},t),{pageName:(0,d.getFileName)(t.path)});s[t.path]=e,this._addItem(r,e.path)}const a=[];return r.childNodes.length&&this._visit(r.childNodes[0],a,"",s,t),a}createOneLevelTreeItems(e){const t=[];for(const r of e){const e=Object.assign(Object.assign({},r),{pageName:(0,d.getFileName)(r.path)}),s={data:e,expanded:this._options.isItemExpanded(e),childItems:this._hasChildItems(e)?[]:void 0};t.push(s)}return t.sort(h),t}replacePathInHierarchy(e,t,r){const s=[];return this._visitAgain(e,s,e.data.path,t,r),s[0]}_hasChildItems(e){return this._options.hasChildItems?this._options.hasChildItems(e):e.isParentPage}_addItem(e,t){const r=a(t);let s=e;for(const e of r.folderParts)s=this._addItemIfRequired(s,e);r.itemName&&this._addItemIfRequired(s,r.itemName)}_addItemIfRequired(e,t){let r=e.getChildNode(t);return r||(r=e.addChildNode(t)),r}_visitAgain(e,t,r,s,i){const a=e.childItems,o=[];if(a)for(const e of a)this._visitAgain(e,o,r,s,i);const n=g(e.data.path,r,s),l=Object.assign(Object.assign({},e.data),{path:n});l.path===s&&(l.pageName=(0,d.getFileName)(s));const h={data:l,expanded:e.expanded,childItems:e.childItems?o:void 0};i[n]=h,t.push(h)}_visit(e,t,r,s,i){const a="/"!==e.name&&""!==e.name,o=this._prependParentPath(r,e.name),n=e.childNodes,l=[];for(let e=0;e<n.length;++e){const t=n[e];this._visit(t,l,o,s,i)}if(l.sort(h),a){const e=s[o];if(e){const r={data:e,expanded:this._options.isItemExpanded(e),childItems:this._hasChildItems(e)?l:void 0};t.push(r),i[o]=r}}else for(let e=0;e<l.length;++e)t.push(l[e])}_prependParentPath(e,t){return null!==e&&""!=e?e.startsWith("/")?"/"===e?e+t:e+"/"+t:"/"+e+"/"+t:t.startsWith("/")?t:"/"+t}}t[e].PathTreeItemMapper=s;class i{constructor(e){this._childMap={},this.childNodes=[],this.name=e}getChildNode(e){return this._childMap[e]}addChildNode(e){const t=new i(e);return this._childMap[e]=t,this.childNodes.push(t),t}}function a(e,t="/"){const r=e.split(t);""===r[r.length-1]&&r.pop();const s=r.pop();return{folderParts:r,itemName:s}}function h(e,t){const r=p(e.data),s=p(t.data);return r===s?(0,n.localeIgnoreCaseComparer)(e.data.pageName,t.data.pageName):r-s}function p(e){return"/.templates"===e.path?1:null!=e.order?2*e.order:Number.MAX_SAFE_INTEGER}function g(e,t,r){return e===t?r:((0,n.endsWith)(t,"/")||(t+="/"),(0,n.endsWith)(r,"/")||(r+="/"),e.replace(t,r))}t[e]._splitItemPath=a,t[e]._treeNodeSortOrderDecider=h,t[e]._replacePagePath=g}("WikiPageTreeItemProvider"),function(e){t[e]={};class r extends p.VssService{constructor(){super(...arguments),this.items=new g.ObservableArray}getBreadcrumbItems(e){return this.items}setBreadcrumbs(e){this.items.removeAll();let t=1;const r=[];let s=e;for(;void 0!==s;){let e=s.underlyingItem.data;r.push({key:`wiki-subtree-breadcrumb-${t}`,text:e.pageName,href:e.remoteUrl,onClick:r=>{(0,h.onClickFPS)(this.pageContext,e.remoteUrl,!0,r,{telemetrySource:`wiki-subtree-breadcrumb-${t}`})}}),s=s.parentItem,t++}this.items.value=r.reverse()}}t[e].WikiTreeHeaderBreadcrumbService=r,p.Services.add("wikitree-header-breadcrumb-service",{serviceFactory:r})}("WikiTreeHeaderBreadcrumbService"),function(e){E=t[e]={};const i="tree-name-text";t[e].RootId=0;class o extends a.VssComponent{constructor(i,o){super(i,o),this._tree=s.createRef(),this._onActivate=(e,t)=>{this.props.getPageIsDisabled(t.data.underlyingItem.data)||this.props.onPathChanged(t.data.underlyingItem.data)},this._renderTreeCell=(i,o,n,l,d,h)=>{const p=l.underlyingItem.data,g=p.path===this.props.selectedPagePath;if(g){this.context.pageContext.getService("wikitree-header-breadcrumb-service").setBreadcrumbs(l)}return s.createElement(r.SimpleTableCell,{columnIndex:o,contentClassName:"no-padding",className:"wiki-node-tree-cell",key:"wiki-col-"+i,role:h},s.createElement("span",{className:"wiki-page-name-cell",onClick:e=>{e.ctrlKey&&!e.isDefaultPrevented()&&this.props.openInNewTab&&(this.props.openInNewTab(p.path),(0,P.preventDefault)(e))}},l.underlyingItem.data.id===t[e].RootId&&this.props.wikiName&&this.props.isShowWikiName?s.createElement("div",{className:(0,a.css)("wiki-tree-root-node",g&&"fontWeightSemiBold",this.props.getPageIsDisabled(l.underlyingItem.data)&&"wiki-tree-node-disabled")},this.props.wikiName):s.createElement(I.TreeExpand,{depth:l.depth,expanded:l.underlyingItem.expanded,onClick:P.preventDefault,onToggle:p.isParentPage?e=>{this.props.onToggle(e,l)}:void 0},s.createElement(t[e].WikiTreeNode,{item:l,isDisabled:this.props.getPageIsDisabled(l.underlyingItem.data),dragDropProps:this.props.dragDropProps,iconName:this._getIconName(p),isSelected:g,highlightIndices:p.highlightedIndices}))))},this._getIconName=e=>this.props.homePagePath===e.path?"Home":this.props.isIncludeEditingAllowed&&(0,d.isInclude)(e.path)?"FileTemplate":"TextDocument";const n=new m.ListSelection({multiSelect:!1,selectOnFocus:!1});n.selectable=e=>{const t=this.props.itemProvider.getItemFromTreeIndex(e);return t?!(!t.subPages||0===t.subPages.length)||!this.props.getPageIsDisabled(t):!(0,T.indexWithinRanges)(e,n.unselectableRanges)},this._tree=this.props.treeRef?this.props.treeRef:this._tree,this.state={selection:n}}static getDerivedStateFromProps(e,t){if(e.selectedPagePath){const r=e.itemProvider.getItemIndex(e.selectedPagePath);-1===r||t.selection.selected(r)||t.selection.select(r)}else t.selection.clear();return t}render(){const e=this.props.itemProvider.length,t=[{id:"pageName",width:-100,renderCell:this._renderTreeCell},...this.props.additionalColumns];return e>0?s.createElement(I.Tree,{scrollable:!0,columns:t,itemProvider:this.props.itemProvider,showLines:this.props.showLines,onToggle:this.props.onToggle,onActivate:this._onActivate,selection:this.state.selection,showHeader:!1,renderRow:(e,r,s)=>{const i=r.underlyingItem.data,a=i.path===this.props.selectedPagePath;return s=Object.assign(Object.assign({},s),{ariaCurrent:a?"page":void 0,ariaLabelledBy:(0,P.getSafeId)(i.path)}),(0,I.renderTreeRow)(e,r,s,t,i)},ref:this._tree,ariaLabel:(0,n.format)(N.WikiPageTreeAriaLabel,this.props.wikiName.replace(".wiki",""))}):s.createElement("div",{className:"no-results-msg"},this.props.emptyTreeMsg)}componentDidMount(){super.componentDidMount(),this._scrollItemToView()}componentDidUpdate(e,t){super.componentDidUpdate(e,t),e.itemProvider!=this.props.itemProvider&&this._scrollItemToView()}_scrollItemToView(){if(this._tree.current&&this.props.selectedPagePath){const e=this.props.itemProvider.getItemIndex(this.props.selectedPagePath);-1!==e&&this._tree.current.scrollIntoView(e)}}}t[e].WikiPagePathTree=o;t[e].WikiTreeNode=r=>{const o=r.item.underlyingItem.data;return s.createElement(k.TreeNodeDraggable,{item:o,canDrag:void 0!==r.dragDropProps&&r.dragDropProps.canDrag(o),canDrop:r.dragDropProps?r.dragDropProps.canDrop:()=>!1,onDrop:r.dragDropProps?r.dragDropProps.onDrop:()=>{},onDrag:r.dragDropProps?r.dragDropProps.onDrag:()=>{},className:"wiki-tree-node text-ellipsis",dataTransferValue:o.path},s.createElement(_.Tooltip,{overflowOnly:!0,text:o.pageName},s.createElement("div",{className:(0,a.css)("text-ellipsis",r.isDisabled&&"wiki-tree-node-disabled")},o.isNonConformant&&s.createElement(u.Status,Object.assign({className:"non-conformant-icon"},u.Statuses.Warning,{key:"warning",size:"16"})),s.createElement(c.Icon,{className:"type-icon fontSizeML",iconName:r.iconName}),s.createElement("span",{className:(0,a.css)("bolt-list-cell-child flex-row flex-center bolt-list-cell-text tree-name-cell",i,r.isSelected?"fontWeightSemiBold":""),id:(0,P.getSafeId)(o.path)},r.highlightIndices&&r.highlightIndices.length>0?s.createElement(t[e].HighlightableRowText,{text:o.pageName,highlightTextIndices:r.highlightIndices}):o.pageName))))};function l(e,t,r,s){return{text:e.substring(t,r),highlight:s}}t[e].HighlightableRowText=e=>s.createElement(s.Fragment,null,function(e,t){if(!e||!e.length)return[];let r=0;const s=[];t=t||[];for(let i=0;i<t.length;i++){for(r!==t[i]&&(s.push(l(e,r,t[i],!1)),r=t[i]);i<t.length&&t[i]+1===t[i+1];)++i;s.push(l(e,r,t[i]+1,!0)),r=t[i]+1}r<e.length&&s.push(l(e,r,e.length,!1));return s}(e.text,e.highlightTextIndices).map(((e,t)=>e.highlight?s.createElement("mark",{key:e.text+t.toString(),className:i},e.text):s.createElement("span",{className:i,key:e.text+t.toString()},e.text))))}("ComponentsWikiPagePathTree"),function(e){t[e]={},Object.defineProperty(t[e],"RootId",{enumerable:!0,get:function(){return E.RootId}});class r extends a.VssComponent{constructor(e,t){super(e,t),this._filterBarRef=s.createRef(),this._filterKey="wikiFilter-"+(0,i.getId)(),this._onTreeFilterChanged=e=>{if(e.hasOwnProperty(this._filterKey)){const t=e[this._filterKey],r=t?t.value:"";""!==r?this.props.onFilterChanged(r):this.props.onFilteringComplete()}},this._onDrop=(e,t,r)=>{this.props.wikiTreeDragDropProps&&this.props.wikiTreeDragDropProps.onDrop(e,this.props.isHandleBrokenLinksEnabled,t,r)},this._onToggle=(e,t)=>{this.props.onPageToggled(t.underlyingItem.data,!t.underlyingItem.expanded)},this._filter=new b.Filter}componentDidMount(){super.componentDidMount(),this._filterBarRef.current&&this.props.setInitialFocusToFilter&&this._filterBarRef.current.focus(),this._filter.subscribe(this._onTreeFilterChanged,b.FILTER_CHANGE_EVENT)}componentWillUnmount(){this._filter.unsubscribe(this._onTreeFilterChanged,b.FILTER_CHANGE_EVENT),super.componentWillUnmount()}render(){const e=this.props.isReorderInProgress;return s.createElement("div",{className:"wiki-tree-pane relative flex-column flex-grow"},s.createElement("div",{className:"absolute-fill flex-column flex-grow"},e&&s.createElement("div",{className:"wiki-tree-reorder-overlay absolute-fill"}),s.createElement(f.FilterBar,{filter:this._filter,className:"wiki-tree-filterbar flex-center",ref:this._filterBarRef,searchRoleAriaLabel:N.SearchAriaLabel},s.createElement(S.KeywordFilterBarItem,{placeholder:N.FilterPagePlaceholder,filterItemKey:this._filterKey,ariaLabel:N.FilterTreeWatermarkText})),this.props.isFilterLoading?s.createElement(v.Spinner,null):this._renderTree()))}_renderTree(){const{isFiltering:e,filterTreeItemProvider:t}=this.props,r={showLines:!1,additionalColumns:this.props.additionalColumns||[],isIncludeEditingAllowed:this.props.isIncludeEditingAllowed,getPageIsDisabled:this.props.getPageIsDisabled?this.props.getPageIsDisabled:()=>!1};let i;return this.props.wikiTreeDragDropProps&&(i={onDrop:this._onDrop,onDrag:this.props.wikiTreeDragDropProps.onDrag,canDrop:this.props.wikiTreeDragDropProps.canDrop,canDrag:this.props.wikiTreeDragDropProps.canDrag}),s.createElement(s.Fragment,null,e?s.createElement(E.WikiPagePathTree,Object.assign({},this.props,{itemProvider:t,onToggle:(e,r)=>t.toggle(r.underlyingItem),onPathChanged:this.props.onFilteredPageSelected,emptyTreeMsg:N.FilteredTree_NoResultsFound},r)):s.createElement(E.WikiPagePathTree,Object.assign({},this.props,{onToggle:this._onToggle,onPathChanged:this.props.onPageSelected,emptyTreeMsg:"",dragDropProps:i},r)))}}t[e].WikiTree=r}("ComponentsWikiTree"),function(e){t[e]={};class r extends C.Store{constructor(){super("FilterTreeStore"),this.onFilteringComplete=()=>{this._state.isFiltering=!1,this._state.isFilterLoading=!1,this._state.filterText="",this.emitChanged()},this.onFilterResultsUpdated=e=>{this._state.isFilterLoading=!1,this._state.treeItemProvider.replaceAllItems(e.filteredPages),e.currentSelectedPagePath&&this._state.treeItemProvider.prepareNextPageToSelect(e.currentSelectedPagePath);const t=e.exactMatchedPagesCount;0===t?(0,D.announce)(N.NoResultFound,!0):1===t?(0,D.announce)(N.OneResultFound,!0):(0,D.announce)((0,n.format)(N.NResultsFound,t),!0),this.emitChanged()},this.onFilterTextChanged=e=>{this._state.isFiltering=!0,this._state.isFilterLoading=!0,this._state.filterText=e,this._state.treeItemProvider.clear(),this.emitChanged()},this._state={treeItemProvider:new F.WikiPageTreeItemProvider([],!0),isFiltering:!1,isFilterLoading:!1,filterText:""}}getState(){return this._state}}t[e].FilterTreeStore=r}("StoresFilterTreeStore"),function(e){t[e]={};t[e].WikiPageFilterProvider=class{constructor(e,t,r,s){this._pageContext=e,this._source=t,this._getPagesForFiltering=r,this._errorHandler=s}filter(e){return this._prepareForFiltering().then((t=>{let r=[];const s=t[0],i=t[1];let a=0;if(s){s.setAllPages(i),r=s.filter(e),a=r.length;const t={},o={};for(const e of r){const r=(0,x.getParentPaths)(e.path);for(const e of r)t[e]=!0;o[e.path]=!0}for(const e of i)t[e.path]&&!o[e.path]&&r.push(Object.assign(Object.assign({},e),{pageName:""}))}return{results:r,exactMatchedPagesCount:a}}),this._errorHandler)}_prepareForFiltering(){const e=this._pageContext.getService("IVssContributionService").getService("ms.vss-wiki-web.wiki-filter-service"),t=this._getPagesForFiltering();return Promise.all([e,t])}}}("UtilitiesWikiPageFilterProvider")}),["Resources","Components/TreeMoreColumn","Components/TreeNodeDraggable","Helper","WikiPageTreeItemProvider","WikiTreeHeaderBreadcrumbService","Components/WikiPagePathTree","Components/WikiTree","Stores/FilterTreeStore","Utilities/WikiPageFilterProvider"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-wiki-web.wiki-page-tree-content"}}));