"use strict";define("Comments/Thread",["require","exports","react","VSS/Core/Util/String","VSS/Platform/Layout","VSSUI/Button","VSSUI/Link","VSSUI/Spinner","VSS/Platform/FPS","Comments/Editor/CommentEditor","VSS/Features/Identities/PersonaDetailsProvider","VSSUI/Persona","VSSUI/Util","VSS/Core/Util/Accessibility","VSS/Core/Observable","VSSUI/List","VSSUI/MessageCard","Comments/Common/Telemetry","Comments/Item/CommentItem"],(function(e,t,n,o,r,s,a,i,d,m,c,l,h,p,C,u,g,_,I){var y,f,E,T,x,P,S,v;y=t[v="Resources"]={},t[v].Reply="Reply",t[v].LoadMore="Load more ({0} remaining)",t[v].Loading="Loading...",t[v].Saving="Saving...",t[v].Add="Add",t[v].Deleted="(deleted)",t[v].Error="Error",t[v].AddAComment="Add a comment...",t[v].CommentAddedMessage="Comment added",t[v].CommentUpdatedMessage="Comment updated",t[v].CommentDeletedMessage="Comment deleted",function(e){f=t[e]={},function(e){e[e.Comment=1]="Comment",e[e.LoadMore=2]="LoadMore",e[e.Add=3]="Add"}(t[e].ItemType||(t[e].ItemType={}))}("ComponentsCommentThreadInternalTypes"),function(e){E=t[e]={};class d extends r.VssComponent{constructor(e,t){super(e,t),this._loadMore=async()=>{const{artifactInfo:e,commentsClient:t,item:n,continuationToken:o,updatePage:r,handleError:s,supportsThreads:a}=this.props,{isLoading:i}=this.state;if(i)return;const d=8+(a&&!n.parentId?32:0)+1;try{this.setState({isLoading:!0});const s=await t.getComments(e,10,!1,n.parentId,o,d);this.setState({isLoading:!1}),r(s,n)}catch(e){s(n,e),this.setState({isLoading:!1})}},this.state={isLoading:!1}}render(){const{count:e,totalCount:t,item:r}=this.props,{isLoading:d}=this.state;if(t===e)return n.createElement(n.Fragment,null);const m=d?y.Loading:(0,o.format)(y.LoadMore,t-e),c=!!r.parentId;return n.createElement(n.Fragment,null,!c&&n.createElement(s.Button,{text:m,className:"load-more-comments-button",onClick:this._loadMore,disabled:d}),c&&n.createElement("div",{className:"load-more-comments-link"},!d&&n.createElement(a.Link,{onClick:this._loadMore},m),d&&n.createElement("span",{className:"flex-row"},n.createElement(i.Spinner,{className:"comment-thread-status-spinner",size:"small"}),n.createElement("span",null,y.Loading))))}}t[e].LoadMoreComponent=d}("ComponentsLoadMoreComponent"),function(e){T=t[e]={};class o extends r.VssComponent{constructor(e,t){super(e,t),this._commentContentRef=n.createRef(),this._onWorkItemClick=(e,t,n)=>{(0,d.onClickFPS)(this.context.pageContext,t,!0)},this.state={loading:!0,renderedText:""};const o=t.pageContext.getService("ILegacyPlatformService");this._mentionProcessModulePromise=o.requireModules(["WorkItemTracking/Scripts/Utils/RichTextPreRenderUtility"])}componentDidMount(){this._initialLoad()}render(){const{loading:e,renderedText:t}=this.state,{markdown:o}=this.props;return o&&o.trim()&&e?n.createElement("span",{className:"flex-column"},n.createElement(i.Spinner,{size:"medium",label:y.Loading})):n.createElement("div",{className:"comment-preview"},n.createElement("div",{className:"comment-content rendered-mark-down",ref:this._commentContentRef,dangerouslySetInnerHTML:{__html:t}}))}async _initialLoad(){const{markdown:e,handleError:t}=this.props;if(e&&e.trim()){let n;const o=this.context.pageContext.getService("IVssContributionService"),r=Object.assign(Object.assign({},this.props.artifactInfo),{commentText:e});o.getDataAsync("ms.vss-comments.comments-markdown-render-data-provider",r).then((e=>{n=e,this.setState({loading:!1,renderedText:n||""}),this._mentionProcessModulePromise.then((e=>{e[0].processHtmlWithMentions(n,this._commentContentRef.current,{onWorkItemClick:this._onWorkItemClick})}))}),(e=>{n=`${y.Error}: ${e.message}`,t(e),this.setState({loading:!1,renderedText:n||""})}))}}}t[e].MarkdownCommentPreview=o}("ComponentsMarkdownCommentPreview"),function(e){x=t[e]={};class o extends r.VssComponent{constructor(e,t){super(e,t),this._addCommentClicked=()=>{const{onStartEditing:e}=this.props;e()},this._onAddComment=(e,t,n)=>{const{onAdd:o}=this.props;o(t)},this._onCancelEdit=(e,t)=>{const{onCancelEditing:n}=this.props;n&&n()},this._onDirtyChange=(e,t)=>{const{onDirtyChange:n}=this.props;n&&n(t)};const n=t.pageContext.getService("IVssPageService").getData();this._currentUser=n&&n.user,this._personaProvider=new c.PersonaDetailsProvider(t.pageContext)}render(){const{onRenderEditor:e,onEditorMounted:t,className:o,disabled:a,isEditing:i,onRenderPreview:d,text:c,uploadImageHandler:p}=this.props,C=(0,h.getSafeId)("add-a-comment-editor");let u={id:-1,createdDate:new Date,createdOnBehalfDate:new Date,createdBy:this._currentUser,createdOnBehalfOf:this._currentUser,modifiedDate:new Date,text:c,renderedText:"",version:0,isDeleted:!1,reactions:[]};return n.createElement("div",{className:(0,r.css)("flex-row flex-grow add-comment",o)},this._currentUser&&n.createElement(l.Persona,{className:"comment-avatar",identity:this._currentUser,size:32,personaProvider:this._personaProvider}),!i&&n.createElement(s.Button,{className:"add-button flex-grow",onClick:this._addCommentClicked,disabled:a,ariaLabel:y.AddAComment},n.createElement("span",{className:"flex-row justify-start flex-grow"},y.AddAComment)),i&&n.createElement(m.CommentEditor,{className:"flex-grow add-comment-editor",comment:u,originalText:"",onUpdate:this._onAddComment,onDirtyChange:this._onDirtyChange,onCancelEdit:this._onCancelEdit,onRenderPreview:d,onRenderEditor:e,onEditorMounted:t,updateButtonText:y.Add,uploadImageHandler:p,ariaLabel:y.AddAComment,ariaLabelledBy:C,placeholder:y.AddAComment}))}}t[e].AddComment=o}("ComponentsAddComment"),function(e){P=t[e]={};class o extends r.VssComponent{constructor(e,t){super(e,t),this._onEditorMounted=()=>{const{onEditorMounted:e,item:t}=this.props;e(t)},this._onStartAdd=()=>{this.setState({isAddVisible:!0,text:""})},this._onCancelAdd=()=>{const{onCancelAdd:e,item:t}=this.props;this.setState({isAddVisible:!1,text:""}),e(t)},this._onAddComment=async e=>{const{artifactInfo:t,commentsClient:n,add:o,handleError:r,item:s}=this.props;try{this.setState({isAdding:!0,text:e});const r=await n.addComment(t,e,s.parentId);(0,p.announce)(y.CommentAddedMessage),this.setState({isAdding:!1,isAddVisible:!1}),o(r,s)}catch(e){this.setState({isAdding:!1}),r(s,e)}},this.state={isAddVisible:!1,isAdding:!1,text:""}}render(){const{readonly:e,item:t,onRenderPreview:o,onDirtyChange:r,uploadImageHandler:s}=this.props,{isAddVisible:d,isAdding:m,text:c}=this.state;if(e)return n.createElement(n.Fragment,null);const l=!!t.parentId;return n.createElement(n.Fragment,null,(!l||d)&&!m&&n.createElement(x.AddComment,{onAdd:this._onAddComment,onCancelEditing:this._onCancelAdd,onStartEditing:this._onStartAdd,onRenderPreview:o,disabled:m,isEditing:d,onEditorMounted:this._onEditorMounted,text:c,onDirtyChange:r,uploadImageHandler:s}),l&&!d&&!m&&n.createElement("div",{className:"reply-comments-link"},n.createElement(a.Link,{onClick:this._onStartAdd},y.Reply)),m&&n.createElement("span",{className:"flex-row"},n.createElement(i.Spinner,{className:"comment-thread-status-spinner",size:"small"}),n.createElement("span",null,y.Saving)))}}t[e].ReplyOrAddComponent=o}("ComponentsReplyOrAddComponent"),function(e){S=t[e]={};class o extends r.VssComponent{constructor(e,t){super(e,t),this._list=n.createRef(),this._isDirtyCount=0,this._renderRow=(e,t,n)=>{switch(t.type){case f.ItemType.Comment:return this._renderComment(t,e,n);case f.ItemType.Add:return this._renderAddReply(t,e,n);case f.ItemType.LoadMore:return this._renderLoadMore(t,e,n);default:throw new Error("Invalid comment item type")}},this._uploadImageHandler=async e=>{const{artifactInfo:t,commentsClient:n}=this.props;return(await n.addCommentAttachment(t,e)).url},this._onPostRenderContent=(e,t)=>{e&&t&&this._mentionProcessModulePromise.then((n=>{n[0].processHtmlWithMentions(e,t,{onWorkItemClick:this._onWorkItemClick})}))},this._onWorkItemClick=(e,t,n)=>{(0,d.onClickFPS)(this.context.pageContext,t,!0)},this._renderError=(e,t)=>{if(e.lastError)return this._renderErrorInternal(t,(()=>this._clearError(e)),e.lastError)},this._renderGlobalError=e=>{if(e)return this._renderErrorInternal(!1,(()=>this.setState({lastError:void 0})),e)},this._onAddEditorMounted=e=>{const t=this._getPageEndIndex(e.parentId);this._scrollIndexIntoView(t)},this._onEditEditorMounted=e=>{const t=this._getCommentIndexById(e);this._scrollIndexIntoView(t)},this._onRenderPersona=e=>n.createElement(l.Persona,{className:"comment-avatar",identity:e,size:32,personaProvider:this._personaProvider}),this._onRenderPreview=e=>n.createElement(T.MarkdownCommentPreview,{markdown:e,artifactInfo:this.props.artifactInfo,handleError:e=>this._handleError("_onRenderPreview",e)}),this._onFocusItem=(e,t)=>{const n=t.data;if(n.type===f.ItemType.Add||n.type===f.ItemType.LoadMore){const{comments:n}=this.state;let o="button,[tabIndex]";t.index===n.length-1&&(o="button");const r=e.target.querySelectorAll(o);r.length>0&&r[0].focus()}},this._onLoadMore=(e,t)=>{const{commentPage:n,parentChildMap:o}=this.state;let r;const s=t.parentId;r=s?o[s]:n,r&&(this._updatePage(e,r),this._usageTelemetry.publishPageMoreComments(r.pagedCount,r.totalCount))},this._onAddComment=(e,t)=>{const{supportsThreads:n}=this.props,{commentPage:o,parentChildMap:r,comments:s}=this.state,a=t.parentId,i=a?r[a]:o;if(i){i.totalCount++,i.pagedCount++;let o=this._getPageEndIndex(a);if(o>=0){const t={type:f.ItemType.Comment,comment:e};if(s.splice(o,0,t),!a&&n){const t={type:f.ItemType.Add,parentId:e.id};o++,s.splice(o,0,t),r[e.id]=this._createEmptyUICommentPage(e.id)}!a&&this._list&&this._list.current&&this._list.current.scrollIntoView(s.length-1)}this._usageTelemetry.publishAddComment(e.text.length,i.totalCount),this._clearError(t)}},this._onCancelAdd=e=>{this._clearError(e)},this._onDelete=async(e,t)=>{if(t){const{artifactInfo:n,commentsClient:o,supportsThreads:r}=this.props,{parentChildMap:s,comments:a}=this.state,i=this._getCommentPageFromCommentId(e);if(!i)return;try{this._setReadOnlyState(e,!0);const d=this._getCommentIndexById(e),m=a.value[d];if(m.comment.isDeleted)return;if(await o.deleteComment(n,e),(0,p.announce)(y.CommentDeletedMessage),i.totalCount--,i.pagedCount--,this._usageTelemetry.publishDeleteComment(t,i.totalCount),r)if(i.parentId)a.splice(d,1);else{if(s[e].totalCount>0)m.comment=Object.assign(Object.assign({},m.comment),{isDeleted:!0,renderedText:y.Deleted}),a.change(d,m);else{const t=this._getPageEndIndex(e);a.splice(d,t-d+1)}}else a.splice(d,1);this._clearError(m)}catch(t){this._handleError("_onDelete",t,a.value[this._getCommentIndexById(e)])}finally{this._setReadOnlyState(e,!1)}}},this._onUpdate=async(e,t,n)=>{const{artifactInfo:o,commentsClient:r}=this.props,{comments:s}=this.state;if(this._getCommentPageFromCommentId(e))try{const n=await r.updateComment(o,e,t);(0,p.announce)(y.CommentUpdatedMessage);const s={type:f.ItemType.Comment,comment:n},a=this._getCommentIndexById(e);if(a>=0){const{comments:e}=this.state;e.change(a,s)}this._setEditState(e,!1)}catch(t){this._handleError("_onUpdate",t,s.value[this._getCommentIndexById(e)])}},this._onStartEdit=e=>{this._setEditState(e,!0)},this._onCancelEdit=(e,t)=>{const{comments:n}=this.state;this._setEditState(e,!1),this._clearError(n.value[this._getCommentIndexById(e)])},this._onCommentDirtyChange=(e,t)=>{this._updateDirtyCount(t)},this._handleAddError=(e,t)=>{this._handleError("addComment",t,e)},this._handleLoadMoreError=(e,t)=>{this._handleError("loadMore",t,e)},this._clearError=e=>{this._updateItemError(e,void 0)},this._onAddReaction=async(e,t,n)=>{const{commentsClient:o,artifactInfo:r}=this.props,s=await o.addCommentReaction(r,e,t),{comments:a}=this.state,i=this._getCommentIndexById(e),d=a.value[i];d.reactionTypeToInfoMap=this._getUpdatedReactionTypeInfoMap(d.reactionTypeToInfoMap,s),a.change(i,d)},this._onDeleteReaction=async(e,t,n)=>{const{commentsClient:o,artifactInfo:r}=this.props,s=await o.deleteCommentReaction(r,e,t),{comments:a}=this.state,i=this._getCommentIndexById(e),d=a.value[i];d.reactionTypeToInfoMap=this._getUpdatedReactionTypeInfoMap(d.reactionTypeToInfoMap,s),a.change(i,d)},this._onGetEngagedUsers=async(e,t,n)=>{const{commentsClient:o,artifactInfo:r}=this.props,s=await o.getReactionRecentUsers(r,e,t),a=this._getCommentIndexById(e),{comments:i}=this.state,d=i.value[a];if(s&&d.reactionTypeToInfoMap&&d.reactionTypeToInfoMap[t]){const e=s.map((e=>({identityId:e.id,identityDisplayName:e.displayName})));d.reactionTypeToInfoMap[t].engagedUsers=e,d.reactionTypeToInfoMap[t].totalCount=e.length,i.change(a,d)}},this._getCommentReactions=e=>{const{comments:t}=this.state,n=this._getCommentIndexById(e);return t.value[n].reactionTypeToInfoMap||{}},this._updateDirtyCount=e=>{const{onDirtyChange:t}=this.props,n=this._isDirtyCount>0;e?this._isDirtyCount++:this._isDirtyCount--;const o=this._isDirtyCount>0;n!=o&&t&&t(o)},this._usageTelemetry=new _.UsageTelemetryHelper(e.artifactInfo,t.pageContext),this._personaProvider=new c.PersonaDetailsProvider(t.pageContext),this.state={parentChildMap:{},comments:new C.ObservableArray},this._currentUser=this._getCurrentUser();const o=t.pageContext.getService("ILegacyPlatformService");this._mentionProcessModulePromise=o.requireModules(["WorkItemTracking/Scripts/Utils/RichTextPreRenderUtility"])}componentWillMount(){this._initialLoad()}componentDidUpdate(e,t){super.componentDidUpdate(e,t),this.props.artifactInfo.artifactId!==e.artifactInfo.artifactId&&this._initialLoad()}render(){const{className:e}=this.props,{commentPage:t,comments:o,isLoading:s,lastError:a}=this.state;return s?n.createElement("div",{className:(0,r.css)("comment-thread flex-column",e)},n.createElement(i.Spinner,{className:"comment-thread-spinner",size:"large",label:y.Loading})):t&&o?n.createElement("div",{className:e},this._renderGlobalError(a),n.createElement(u.ScrollableList,{itemProvider:o,virtualize:!0,pageSize:20,rowHeight:30,renderRow:this._renderRow,className:"comment-thread",onFocus:this._onFocusItem,ref:this._list,excludeTabStop:!0})):n.createElement(n.Fragment,null)}_renderComment(e,t,o){const{artifactInfo:s,readonly:a,commentsClient:i,supportsImageUpload:d,supportsReactions:m,formatDisabled:c}=this.props,l=e.comment.id,h=!!e.comment.parentId,p=this._getCommentReactions(l);return n.createElement(u.ListItem,{className:"comment-item",details:o,index:t,key:l},n.createElement("div",{className:(0,r.css)("flex-column flex-grow",h&&"child-thread")},this._renderError(e,!0),n.createElement(I.CommentItem,{key:l,artifactInfo:s,comment:e.comment,isEditing:!0===e.isEditing,canEdit:!e.readonly&&!e.comment.isDeleted&&this._isCurrentUserCommentCreator(e.comment),formatDisabled:c,onStartEdit:this._onStartEdit,onCancelEdit:this._onCancelEdit,onUpdate:this._onUpdate,onRenderPreview:this._onRenderPreview,onEditorMounted:this._onEditEditorMounted,readonly:e.readonly||a||e.comment.isDeleted,onConfirmDelete:this._onDelete,className:"flex-grow",viewerContentClassName:"rendered-mark-down",isReactionsEnabled:m,onAddReaction:this._onAddReaction,onDeleteReaction:this._onDeleteReaction,onGetRecentlyReactedUsers:this._onGetEngagedUsers,reactionTypeToInfoMap:p,onRenderPersona:this._onRenderPersona,onPostRenderContent:this._onPostRenderContent,onDirtyChange:this._onCommentDirtyChange,uploadImageHandler:d&&i.addCommentAttachment?this._uploadImageHandler:void 0})))}_renderAddReply(e,t,o){const{artifactInfo:s,readonly:a,commentsClient:i,supportsImageUpload:d}=this.props,m=!!e.parentId;return n.createElement(u.ListItem,{className:"comment-item",details:o,index:t,key:t},n.createElement("div",{className:(0,r.css)("flex-column flex-grow",m&&"child-thread")},this._renderError(e,!0),n.createElement(P.ReplyOrAddComponent,{artifactInfo:s,commentsClient:i,readonly:a,item:e,add:this._onAddComment,onEditorMounted:this._onAddEditorMounted,onRenderPreview:this._onRenderPreview,handleError:this._handleAddError,onCancelAdd:this._onCancelAdd,onDirtyChange:this._updateDirtyCount,uploadImageHandler:d&&i.addCommentAttachment?this._uploadImageHandler:void 0})))}_renderLoadMore(e,t,o){const{artifactInfo:s,supportsThreads:a,commentsClient:i}=this.props,{parentChildMap:d,commentPage:m}=this.state,c=e.parentId,l=!!e.parentId,h=c?d[c]:m;return n.createElement(u.ListItem,{className:"comment-item",details:o,index:t,key:t},n.createElement("div",{className:(0,r.css)("flex-column flex-grow",l&&"child-thread")},this._renderError(e,l),n.createElement(E.LoadMoreComponent,{artifactInfo:s,commentsClient:i,count:h.pagedCount,totalCount:h.totalCount,continuationToken:h.continuationToken,supportsThreads:a,item:e,updatePage:this._onLoadMore,handleError:this._handleLoadMoreError})))}_renderErrorInternal(e,t,o){return n.createElement(g.MessageCard,{severity:"Error",className:(0,r.css)("error-card",e&&"indented-error-card"),onDismiss:t},o)}_scrollIndexIntoView(e){this._list&&this._list.current&&e>=0&&this._list.current.scrollIntoView(e,{block:"nearest"})}_setEditState(e,t){this._updateCommentState(e,(e=>t!==!!e.isEditing&&(e.isEditing=t,!0)))}_setReadOnlyState(e,t){this._updateCommentState(e,(e=>t!==!!e.readonly&&(e.readonly=t,!0)))}_updateCommentState(e,t){const n=this._getCommentIndexById(e);if(n>=0){const{comments:e}=this.state,o=e.value[n];t(o)&&e.change(n,o)}}_updateItemError(e,t){const{comments:n}=this.state;if(e&&e.lastError!==t){e.lastError=t;const o=this._getCommentIndex(e);o>=0&&n.change(o,e)}}_getCommentPageFromCommentId(e){const{commentPage:t,parentChildMap:n,comments:o}=this.state;if(!t)return;const r=this._getCommentIndexById(e);if(r>=0){const e=o.value[r].comment.parentId;return e?n[e]:t}}async _initialLoad(){let{commentPage:e,lastArtifact:t}=this.state;const{commentsClient:n,artifactInfo:o,supportsThreads:r}=this.props,s=8+(r?32:0)+1;if(!e||t!==o.artifactId)try{this.setState({comments:new C.ObservableArray,commentPage:void 0,parentChildMap:{},isLoading:!0,lastError:void 0,lastArtifact:o.artifactId});const t=await n.getComments(o,10,!1,void 0,void 0,s);this.state.lastArtifact===this.props.artifactInfo.artifactId&&(e=this._createUICommentPage(t),e.pagedCount=0,this._updatePage(t,e),this.setState({isLoading:!1}),this._usageTelemetry.publishLoadComments(e.totalCount))}catch(e){this._handleError("_initialLoad",e)}}_updatePage(e,t){const{supportsThreads:n}=this.props;let{parentChildMap:o,commentPage:r}=this.state;t.continuationToken=e.continuationToken,r||(r=t),t.pagedCount+=e.comments.length,n&&e.comments&&e.comments.forEach((e=>{e.replies&&e.replies.totalCount>0?o[e.id]=this._createUICommentPage(e.replies,e.id):o[e.id]=this._createEmptyUICommentPage(e.id)})),this.setState({commentPage:r,parentChildMap:o,lastError:void 0}),this._insertPage(e,t)}_insertPage(e,t){const{supportsThreads:n,readonly:o}=this.props,{parentChildMap:r,comments:s}=this.state,a=!t.parentId;let i,d=!1;if(a)if(i=0,0===s.length)o||s.splice(0,0,{type:f.ItemType.Add,parentId:t.parentId}),d=!0;else{s.value[0].type===f.ItemType.LoadMore&&(t.pagedCount===t.totalCount?s.splice(0,1):i++)}else if(i=this._getCommentIndexById(t.parentId)+1,i<s.length){const e=s.value[i];this._getParentId(e)===t.parentId?t.pagedCount===t.totalCount?s.splice(i,1):i++:(o||s.splice(i,0,{type:f.ItemType.Add,parentId:t.parentId}),d=!0)}else d=!0;e.comments&&e.comments.forEach((e=>{e.isDeleted&&(e.renderedText=y.Deleted);const t={};e.reactions&&e.reactions.forEach((e=>{const n={totalCount:e.count,isCurrentUserEngaged:e.isCurrentUserEngaged,engagedUsers:[]};t[e.type]=n})),s.splice(i,0,{type:f.ItemType.Comment,comment:e,reactionTypeToInfoMap:t}),n&&a&&(e.replies&&e.replies.totalCount>0?this._insertPage(e.replies,r[e.id]):o||s.splice(i+1,0,{type:f.ItemType.Add,parentId:e.id}))})),d&&t.pagedCount<t.totalCount&&s.splice(i,0,{type:f.ItemType.LoadMore,parentId:t.parentId})}_createUICommentPage(e,t){return{totalCount:e.totalCount,continuationToken:e.continuationToken,parentId:t,pagedCount:e.comments.length}}_createEmptyUICommentPage(e){return{totalCount:0,pagedCount:0,continuationToken:"",parentId:e}}_getPageStartIndex(e){const{comments:t}=this.state;if(0===t.length||!e)return 0;const n=this._getCommentIndexById(e);return n<0||n>=t.length?-1:n+1}_getPageEndIndex(e){const{comments:t}=this.state,n=this._getPageStartIndex(e);if(!e)return t.length-1;if(n>=0){let o=n;for(;o<t.length;){const n=t.value[o];if(this._getParentId(n)!==e)return o-1;o++}return o-1}return-1}_getParentId(e){switch(e.type){case f.ItemType.Add:return e.parentId;case f.ItemType.LoadMore:return e.parentId;case f.ItemType.Comment:return e.comment.parentId}return-1}_getCommentIndex(e){const{comments:t}=this.state;return t.value.findIndex((t=>t===e))}_getCommentIndexById(e){const{comments:t}=this.state;return t.value.findIndex((t=>t.type===f.ItemType.Comment&&t.comment.id===e))}_handleError(e,t,n){t&&!t.canceled&&(this._usageTelemetry.traceError("CommentThread."+e,t),n?this._updateItemError(n,t.message):this.setState({lastError:t.message}))}_getCurrentUser(){const e=this.context.pageContext.getService("IVssPageService").getData();return e?e.user:void 0}_isCurrentUserCommentCreator(e){return null!=this._currentUser&&(e.createdOnBehalfOf&&this._currentUser.id===e.createdOnBehalfOf.id||this._currentUser.id===e.createdBy.id)}_getUpdatedReactionTypeInfoMap(e,t){const n={totalCount:t.count,isCurrentUserEngaged:t.isCurrentUserEngaged,engagedUsers:[]},o=Object.assign({},e);return o[t.type]=n,o}}t[e].CommentThread=o,r.VssComponent.register("comment-thread",o)}("ComponentsCommentThread"),function(e){t[e]={},Object.defineProperty(t[e],"CommentThread",{enumerable:!0,get:function(){return S.CommentThread}})}("CommentThread")}),["Resources","Components/CommentThreadInternalTypes","Components/LoadMoreComponent","Components/MarkdownCommentPreview","Components/AddComment","Components/ReplyOrAddComponent","Components/CommentThread","CommentThread"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-comments.thread"}}));