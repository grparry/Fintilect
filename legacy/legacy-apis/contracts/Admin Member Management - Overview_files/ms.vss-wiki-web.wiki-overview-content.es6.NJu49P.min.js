"use strict";define("Wiki/Overview",["require","exports","Wiki/ViewCommon/WrappedDialogHelper","Wiki/Clients/Wiki/RestClient/Wiki","Wiki/ViewCommon/Utils/PageHelper","Wiki/ViewCommon/Utils/WikiHelper","VSS/Core/Util/Accessibility","VSS/Reflux/Store","VSS/Core/Util/String","VSSUI/Clipboard","Wiki/ViewCommon/Utils/PathHelper","Wiki/PageTree/WikiPageTreeItemProvider","VSS/Reflux/Action","Wiki/ViewCommon/ActionListener","VSS/Platform/Feature","VSS/Platform/Util/Url","Wiki/PageTree/Utilities/WikiPageFilterProvider","VSS/Platform/FPS","Wiki/ViewCommon/Constants","react","VSS/Platform/Layout","Wiki/PageTree/Components/TreeMoreColumn","Wiki/PageTree/Components/WikiTree","VSSUI/Util","VSSUI/Button","VSSUI/Header","VSSUI/HeaderCommandBar","VSSUI/MessageCard","VSSUI/SplitButton","VSS/Core/Util/Object","VSS/Platform/Location","VSSUI/Icon","VSSUI/Spinner","VSSUI/Splitter","VSSUI/TooltipEx","VSSUI/ZeroData","Wiki/Renderer/WikiMarkdownRenderer","Wiki/PageTree/Stores/FilterTreeStore"],(function(e,t,i,o,r,a,s,n,h,d,g,p,c,l,P,m,v,u,w,S,_,k,C,f,I,b,E,A,x,F,T,L,y,M,W,N,H,D){var R,O,U,V,B,j,z,G,Z,q,K,X,Q,J,Y,$,ee,te;R=t[te="Resources"]={},t[te].CopyPagePathMenuItemText="Copy page path",t[te].IsAFolder="'{0}' is a folder",t[te].PrintPageMenuItemText="Print",t[te].EditPageMenuItemText="Edit",t[te].EditInReposMenuItemText="Edit in Repos",t[te].MoreEditOptions_Label="More edit options",t[te].LinkWitMenuItemText="Link work items",t[te].MovePageDefaultComment="Page '{0}' moved from parent '{1}' to '{2}'",t[te].MovePageMenuItem="Move page",t[te].TreeAllPagesHeader="Pages",t[te].PageRevisionsMenuItemText="View revisions",t[te].NewPageActionButton="New page",t[te].ShowLessNavPane="Show less information",t[te].ShowMoreNavPane="Show more information",t[te].SeparatorAriaLabel="Splitter",t[te].FilterTreeWatermarkText="Filter pages by title",t[te].DeletePageText="Delete",t[te].OpenInNewTabText="Open in new tab",t[te].SetAsHomePage="Set as wiki Homepage",t[te].LearnMoreToastCTA="Learn more",t[te].AddSubPage="Add sub-page",t[te].FilteredTree_NoResultsFound="No results found",t[te].MovePagePanel_MoveButtonText="Move",t[te].MovePagePanel_BrokenLinkFixing_Title="Move '{0}'",t[te].MovePagePanel_BrokenLinkFixing_Description="Moving from '{0}' to '{1}'.",t[te].MovePagePanel_BrokenLinkFixing_SuccessMessage="Page moved successfully.",t[te].MovePagePanel_BrokenLinkFixing_BrokenLinksDiscoveryOrMoveFailureMessage="Move page failed. Please try again later.",t[te].MovePagePanel_BrokenLinkFixing_LinksFixFailureMessage="The page was moved but some links to the page couldn't be updated.",t[te].PageNotFound="Page does not exist",t[te].ViewShortcutGroupHeading="Wiki",t[te].TreeShortcut_MoveUp="Move page up the order",t[te].TreeShortcut_MoveDown="Move page down the order",t[te].WindowTitleForNewPage="New page - Wiki",t[te].NonConformantPageError="Could not load the page. Either the page's title or any of its ancestor page's title does not conform to Wiki standards.",t[te].PageLearnMoreText="Learn more",t[te].NonConformancePageLearnMoreLink="https://go.microsoft.com/fwlink/?linkid=2087602",t[te].CreateAndEmbedWITLearnMoreLink=" https://go.microsoft.com/fwlink/?linkid=2098186",t[te].CreateAndEmbedWITFailedLearnMoreAriaLabel="Learn more about the reasons for work item embed failure",t[te].PageShortcut_Add="Add new page",t[te].PageShortcut_AddSubPage="Create new sub-page",t[te].PageShortcut_Edit="Edit page",t[te].PageShortcut_Print="Print current page",t[te].IncludesPrimaryMessage="Reuse content, reduce redundancy.",t[te].IncludesSecondaryMessage="Templates are reusable markdown pages that can be used within multiple wiki pages.",t[te].AddIncludeText="Add template",t[te].IncompleteOrderFileErrorMessage="The order file in this hierarchy is missing page entries. Please refer our documentation to fix it",t[te].IncompleteOrderFileOpenDocs="Open docs",t[te].IncompleteOrderFileErrorLink="https://go.microsoft.com/fwlink/?linkid=2096100",t[te].AddPageContent="Add page content",t[te].CreatedAndEmbeddedWit="Created and embedded {0} with id {1}",t[te].MovePage_BrokenLinkFixing_Title="Move page",t[te].MovePageDialog_BrokenLinkFixing_MoveButtonText="Move",t[te].MoveWithoutFixingButtonText="Move without fixing",t[te].MovePage_BrokenLinkFixing_FixAndMoveButtonText="Fix and move",t[te].MovePage_BrokenLinkFixing_SuccessMessage="Page moved successfully from '{0}' to '{1}'.",t[te].MovePage_BrokenLinkFixing_AutoFix="Moving page '{0}' to '{1}'.",t[te].OnCopyPagePathMessage="Page path copied!",t[te].WikiOverview="Wiki overview",function(e){O=t[e]={},t[e].showDeletePageDialog=function(e,t){(0,i.showWrappedDialog)(e,Object.assign({},t),"Wiki.DeletePageDialog",["ms.vss-wiki-web.wiki-deletepage-dialog-content"])},t[e].showMovePagePanel=function(e,t){(0,i.showWrappedDialog)(e,Object.assign({},t),"Wiki.PageMovePanel",["ms.vss-wiki-web.wiki-pagemove-panel-content","ms.vss-wiki-web.search-location-include"])},t[e].showLinkWorkItemPanel=function(e,t){(0,i.showWrappedDialog)(e,Object.assign({},t),"Wiki.LinkWitPanel",["ms.vss-wiki-web.wiki-linkwit-content"])},t[e].showMoveConfirmationDialogOrPanel=function(e,t,o,r){r?(0,i.showWrappedDialog)(e,Object.assign({},t),"Wiki.PageRenamePanel",["ms.vss-wiki-web.page-rename-panel-content","ms.vss-wiki-web.search-location-include"]):(0,i.showWrappedDialog)(e,Object.assign({},o),"Wiki.MovePageConfirmationDialog",["ms.vss-wiki-web.wiki-move-page-confirmation-dialog-content"])}}("OverviewDialogHandler"),function(e){U=t[e]={};t[e].WikiPageSource=class{constructor(e){this._wikiRestClient=(0,o.getWikiClient)(e)}getAllPages(e,t){return this.getPageWithHierarchy(e,t,"/")}getPageWithHierarchy(e,t,i){return this._wikiRestClient.getPage(e.projectId,e.id,i,120,t).then((e=>(0,r.flattenWikiPage)(e.page)))}getPageChildren(e,t,i){return i.isParentPage?this._wikiRestClient.getPage(e.projectId,e.id,i.path,1,t).then((e=>e&&e.page?e.page.subPages:[])):Promise.resolve([])}getPageInfo(e,t,i){return this._wikiRestClient.getPage(e.projectId,e.id,t,0,i,!0).then((e=>Object.assign(Object.assign({},e.page),{version:e.eTag[0]})))}getInitialTreeHierarchy(e,t,i,o){const r=e.getService("IVssContributionService"),s={wikiId:t.id,wikiVersion:(0,a.getVersionFromBranchName)(i.version),pagePath:o};return r.getDataAsync("ms.vss-wiki-web.wiki-pages-only-data-provider",s)}movePage(e,t,i,o,r,a){return this._wikiRestClient.createPageMove({path:o,newPath:i,newOrder:r&&r<0?0:r},e.projectId,e.id,a,t)}reorderPage(e,t,i,o){return this._wikiRestClient.createPageMove({path:i,newOrder:o,newPath:i},e.projectId,e.id,void 0,t).then((e=>e.pageMove.page))}createOrUpdatePage(e,t,i,o,r,a){return this._wikiRestClient.createOrUpdatePage({content:i},e.projectId,e.id,t,o,r,a)}}}("SourcesWikiPageSource"),function(e){V=t[e]={};class i extends n.Store{constructor(e,t){super("OverviewStore"),this.getState=()=>this._state,this.editorModuleLoaded=()=>{this._state.isEditorModuleLoaded=!0,this.emitChanged()},this.startEditingNewPage=e=>{this._state.tempPageInfo=e,this._startEditing()},this.startEditing=e=>{this._state.pageInfo=e,this._startEditing()},this.startEditingCurrentPage=()=>{this._startEditing()},this.closeEditor=()=>{this._state.isEditing=!1,this._state.tempPageInfo=void 0,this._state.navPaneState.isCollapsed=!1,this._state.anchor=void 0,this.emitChanged()},this.onAnchorClicked=e=>{this._state.anchor=e,this.emitChanged()},this.onAnchorRemoved=()=>{this._state.anchor=void 0,this.emitChanged()},this.onPageSelected=(e,t,i)=>{this._state.pageInfo=e&&Object.assign(Object.assign({},e),{version:void 0}),i||(this._state.errorState=void 0),this._state.anchor=t,this._state.isPageInfoLoading=!0,this.emitChanged()},this.onPageInfoLoaded=e=>{e.isSystemAction||(this._state.errorState=void 0),this._state.pageInfo=e.wikiPageInfo,this._state.isPageInfoLoading=!1,this.emitChanged()},this.onPageReordered=e=>{this.updateError({message:e.errorMessage,buttonProps:e.errorButtonProps})},this.savePage=e=>{this._state.pageInfo=Object.assign(Object.assign({},e.page),{version:e.pageVersion}),this._state.refreshFollowStatus=!0,this._state.tempPageInfo=void 0,e.closeEditor?this.closeEditor():this.emitChanged()},this.updateNavPaneSize=e=>{this._state.navPaneState.currentSize=e,this._state.navPaneState.isCollapsed=!1,this.emitChanged()},this.updateNavPaneVisibility=e=>{this._state.navPaneState.isCollapsed=e,this.emitChanged()},this.onUnsetUnfollowPage=()=>{this._state.isPageUnfollow=!1},this.onRefreshFollowStatus=e=>{this._state.refreshFollowStatus=e},this.updateError=e=>{this._state.errorState=e||{},this.emitChanged(),this._state.errorState.message&&(0,s.announce)(this._state.errorState.message)},this._startEditing=()=>{this._state.isEditing=!0,this._state.errorState=void 0,this._state.navPaneState.isCollapsed=!0,this.emitChanged()},this._state={anchor:e.anchor,isPageUnfollow:e.unfollow,pageInfo:t,isPageInfoLoading:!1,isEditorModuleLoaded:!1,navPaneState:{isCollapsed:!1,currentSize:320}}}}t[e].OverviewStore=i}("StoresOverviewStore"),function(e){B=t[e]={},t[e].copyPagePathToClipboard=function(e,t){const i=(0,h.format)("[{0}]({1})",(0,g.getFileName)(t),(0,g.getLinkFromPath)(t));(0,d.copyToClipboard)(i),e.getService("IGlobalMessagesService").addToast({message:R.OnCopyPagePathMessage,duration:3e3})},t[e].isTopLevelPage=function(e){return 0===e.lastIndexOf("/")},t[e].getPageInfoWithName=function(e){return{content:e.content,pageId:e.id,version:e.version,pageName:(0,g.getFileName)(e.path),parentPath:(0,g.getParentPath)(e.path)}},t[e].isFolderAssociatedPage=function(e){return e&&e.isParentPage&&null==e.gitItemPath||e&&"/"===e.path},t[e].ingestPageView=function(e,t,i,o){let r=location.hash;e.getService("IVssContributionService").getDataAsync("ms.vss-wiki-web.wiki-page-view-data-provider",{wikiId:t,pageId:i,pagePath:o},!0).then((()=>{location.hash!==r&&(location.hash=r);e.getService("IVssContributionEventService").fireEvent("wikipage-activity",void 0,!1)}))}}("UtilsWikiHelper"),function(e){var i;j=t[e]={},function(e){e[e.None=0]="None",e[e.Partial=1]="Partial",e[e.Complete=2]="Complete"}(i=t[e].PagesHierarchyFetchedStatus||(t[e].PagesHierarchyFetchedStatus={}));class o extends n.Store{constructor(e,t,o){super("WikiTreeStore"),this.childPagesFetched=e=>{this._state.pagesFetchedStatus===i.Complete?this._state.treeItemProvider.toggleItem(e.parentPath,!0):this._state.treeItemProvider.addChildItems(e.parentPath,e.childPages),this.emitChanged()},this.treeItemToggled=e=>{this._state.treeItemProvider.toggleItem(e.pagePath,e.isExpanded),this.emitChanged()},this.onPageMoved=e=>{const t=e.sourcePage.path,i=e.pageMoveResponse.pageMove.newPath,o=e.pageMoveResponse.pageMove.newOrder;(0,B.isTopLevelPage)(i)&&0===o?(this._state.homePagePath=i,this.emitChanged()):this._state.homePagePath===t&&(this._makeSecondPageAsHomePage(),this.emitChanged()),this._state.treeItemProvider.moveItem(e.sourcePage.path,i,o),this.emitChanged()},this.onPageHierarchyReloaded=e=>{this._state.treeItemProvider.onPageHierarchyReloaded(e.pagePath,e.flattenedHierarchy),this.emitChanged()},this.onFilteringComplete=e=>{e.lastSelectedPage&&this._state.treeItemProvider.prepareNextPageToSelect(e.lastSelectedPage),this.emitChanged()},this.onPageReorderStarted=()=>{this._state.isReorderInProgress=!0,this.emitChanged()},this.loadPartialPages=e=>{this._state.pagesFetchedStatus===i.None&&(this._state.treeItemProvider.replaceAllItems(e.pagesFetched),this._state.pagesFetchedStatus=i.Partial),this._setHomePagePath(),e.pathToSelect&&(this._state.treeItemProvider.prepareNextPageToSelect(e.pathToSelect),this._state.treeItemProvider.toggleItem(e.pathToSelect,!0)),this.emitChanged()},this.onError=()=>{this._state.isReorderInProgress=!1,this.emitChanged()},this.onPageReordered=e=>{(0,B.isTopLevelPage)(e.pagePath)&&(0===e.newOrder?this._state.homePagePath=e.pagePath:0===e.oldOrder&&this._makeSecondPageAsHomePage()),this._state.isReorderInProgress=!1,this._state.treeItemProvider.reorderItem(e.pagePath,e.newOrder),this.emitChanged()},this.loadAllPages=e=>{this._state.pagesFetchedStatus===i.Partial?this._state.treeItemProvider.completeExistingItems(e.pagesFetched):this._state.treeItemProvider.replaceAllItems(e.pagesFetched),this._setHomePagePath(),e.pathToSelect&&this._state.treeItemProvider.prepareNextPageToSelect(e.pathToSelect),this._state.pagesFetchedStatus=i.Complete,this.emitChanged()},this.pageSaved=e=>{if(""===e.oldPagePath){const t=e.page.order;(0,B.isTopLevelPage)(e.page.path)&&0===t&&(this._state.homePagePath=e.page.path),this._state.treeItemProvider.addItem(e.page),this.emitChanged()}else e.oldPagePath!=e.page.path&&(this._state.homePagePath===e.oldPagePath&&(this._state.homePagePath=e.page.path),this._state.treeItemProvider.renameItem(e.oldPagePath,e.page),this.emitChanged())},this.pageDeleted=e=>{if(this._state.treeItemProvider.deletePage(e.deletedPagePath),this._state.homePagePath===e.deletedPagePath){const e=this._state.treeItemProvider.getFirstConformantChild("/");this._state.homePagePath=e?e.path:void 0}this.emitChanged()};const r=new p.WikiPageTreeItemProvider(t||[],!1);this._state={treeItemProvider:r,pagesFetchedStatus:e?i.Partial:i.None,isReorderInProgress:!1,homePagePath:void 0},this._setHomePagePath()}getState(){return this._state}_setHomePagePath(){const e=this._state.treeItemProvider.getNthChild("/",1);e&&!e.isNonConformant&&(this._state.homePagePath=e.path)}_makeSecondPageAsHomePage(){const e=this._state.treeItemProvider.getNthChild("/",2);e&&!e.isNonConformant?this._state.homePagePath=e.path:this._state.homePagePath=void 0}}t[e].WikiTreeStore=o}("StoresWikiTreeStore"),function(e){z=t[e]={};t[e].OverviewActions=class{constructor(){this.editorModuleLoaded=new c.Action,this.startEditing=new c.Action,this.startEditingNewPage=new c.Action,this.startEditingCurrentPage=new c.Action,this.closeEditor=new c.Action,this.contentTranslatedForEditor=new c.Action,this.anchorClicked=new c.Action,this.anchorRemoved=new c.Action,this.linkedWitUpdated=new c.Action,this.allPagesFetched=new c.Action,this.childPagesFetched=new c.Action,this.pageSelected=new c.Action,this.pageInfoLoaded=new c.Action,this.onPageMoveCompleted=new c.Action,this.treeItemToggled=new c.Action,this.pageSaved=new c.Action,this.pageDeleted=new c.Action,this.pageReordered=new c.Action,this.pageHierarchyReloaded=new c.Action,this.pageReorderStarted=new c.Action,this.partialPagetreeLoaded=new c.Action,this.navPaneResized=new c.Action,this.navPaneVisibilityChanged=new c.Action,this.onFilteringComplete=new c.Action,this.onFilterTextUpdated=new c.Action,this.onFilterResultsUpdated=new c.Action,this.unsetUnfollowPage=new c.Action,this.refreshFollowStatus=new c.Action,this.onErrorChanged=new c.Action,this.onEmbedWitFailed=new c.Action}};t[e].StoresHub=class{constructor(e,t){this.stores=e,this._overviewActions=t,this.removeActionListeners=()=>{this._actionListener.removeListeners(),this._asyncEditorStoreActionsListenerRemover&&this._asyncEditorStoreActionsListenerRemover(),this._asyncHeaderMetaDataStoreActionsListenerRemover&&this._asyncHeaderMetaDataStoreActionsListenerRemover()},this.getState=()=>({treeState:this.stores.treeStore.getState(),overviewState:this.stores.overviewStore.getState(),filterState:this.stores.filterStore.getState()}),this._resetEditorState=()=>{const e=this.stores.overviewStore.getState().pageInfo;let t;e&&(t=(0,g.getFileName)(e.path)),this.asyncEditorStore&&void 0!==t&&this.asyncEditorStore.resetState(t)},this._actionListener=new l.ActionListener,this._actionListener.addListener(this._overviewActions.editorModuleLoaded,e.overviewStore.editorModuleLoaded),this._actionListener.addListener(this._overviewActions.startEditing,(t=>{e.overviewStore.startEditing(t),this.asyncEditorStore&&this.asyncEditorStore.resetState((0,g.getFileName)(t.path))})),this._actionListener.addListener(this._overviewActions.startEditingNewPage,(t=>{e.overviewStore.startEditingNewPage(Object.assign(Object.assign({},t.newPageInfo),{pageName:""})),this.asyncEditorStore&&this.asyncEditorStore.resetState(t.newPageInfo.pageName,t.zeroDay)})),this._actionListener.addListener(this._overviewActions.startEditingCurrentPage,(()=>{e.overviewStore.startEditingCurrentPage(),this._resetEditorState()})),this._actionListener.addListener(this._overviewActions.contentTranslatedForEditor,(e=>{this.asyncEditorStore&&this.asyncEditorStore.initializeTranslatedContent(e)})),this._actionListener.addListener(this._overviewActions.anchorClicked,e.overviewStore.onAnchorClicked),this._actionListener.addListener(this._overviewActions.anchorRemoved,e.overviewStore.onAnchorRemoved),this._actionListener.addListener(this._overviewActions.closeEditor,(()=>{e.overviewStore.closeEditor(),this._resetEditorState()})),this._actionListener.addListener(this._overviewActions.linkedWitUpdated,(e=>{this.asyncHeaderMetaDataStore&&this.asyncHeaderMetaDataStore.onLinkedWorkItemsUpdated(e)})),this._actionListener.addListener(this._overviewActions.pageSaved,(t=>{e.overviewStore.savePage(t),this.asyncEditorStore&&this.asyncEditorStore.updateSavePageStatus(2)})),this._actionListener.addListener(this._overviewActions.pageInfoLoaded,e.overviewStore.onPageInfoLoaded),this._actionListener.addListener(this._overviewActions.childPagesFetched,e.treeStore.childPagesFetched),this._actionListener.addListener(this._overviewActions.treeItemToggled,e.treeStore.treeItemToggled),this._actionListener.addListener(this._overviewActions.allPagesFetched,e.treeStore.loadAllPages),this._actionListener.addListener(this._overviewActions.pageDeleted,e.treeStore.pageDeleted),this._actionListener.addListener(this._overviewActions.pageReorderStarted,e.treeStore.onPageReorderStarted),this._actionListener.addListener(this._overviewActions.pageReordered,e.treeStore.onPageReordered),this._actionListener.addListener(this._overviewActions.pageReordered,e.overviewStore.onPageReordered),this._actionListener.addListener(this._overviewActions.onPageMoveCompleted,e.treeStore.onPageMoved),this._actionListener.addListener(this._overviewActions.pageHierarchyReloaded,e.treeStore.onPageHierarchyReloaded),this._actionListener.addListener(this._overviewActions.onFilteringComplete,e.treeStore.onFilteringComplete),this._actionListener.addListener(this._overviewActions.pageSaved,e.treeStore.pageSaved),this._actionListener.addListener(this._overviewActions.onFilterTextUpdated,e.filterStore.onFilterTextChanged),this._actionListener.addListener(this._overviewActions.onFilteringComplete,e.filterStore.onFilteringComplete),this._actionListener.addListener(this._overviewActions.onFilterResultsUpdated,e.filterStore.onFilterResultsUpdated),this._actionListener.addListener(this._overviewActions.pageSelected,(t=>{e.overviewStore.onPageSelected(t.wikiPage,t.anchor,t.isSystemAction)})),this._actionListener.addListener(this._overviewActions.partialPagetreeLoaded,e.treeStore.loadPartialPages),this._actionListener.addListener(this._overviewActions.navPaneResized,e.overviewStore.updateNavPaneSize),this._actionListener.addListener(this._overviewActions.navPaneVisibilityChanged,e.overviewStore.updateNavPaneVisibility),this._actionListener.addListener(this._overviewActions.unsetUnfollowPage,e.overviewStore.onUnsetUnfollowPage),this._actionListener.addListener(this._overviewActions.refreshFollowStatus,e.overviewStore.onRefreshFollowStatus),this._actionListener.addListener(this._overviewActions.onEmbedWitFailed,e.overviewStore.updateError),this._actionListener.addListener(this._overviewActions.onErrorChanged,(t=>{e.overviewStore.updateError({message:t||void 0})})),this._actionListener.addListener(this._overviewActions.onErrorChanged,e.treeStore.onError)}registerEditorStore(e,t){null==this.asyncEditorStore&&(this.asyncEditorStore=e,this._asyncEditorStoreActionsListenerRemover=t)}registerHeaderMetaDataStore(e,t){null==this.asyncHeaderMetaDataStore&&(this.asyncHeaderMetaDataStore=e,this._asyncHeaderMetaDataStoreActionsListenerRemover=t)}}}("StoresStoresHub"),function(e){G=t[e]={};t[e].WikiPageSwitchTtiLogger=class{constructor(e){this._pageContext=e,this._performanceService=this._pageContext.getService("IVssPerformanceService"),this._isScenarioStarted=!1}startScenario(){this._performanceService.startScenario("NewWiki.Overview.Load",!0,void 0,{isFirstRender:!1}),this._isScenarioStarted=!0}endScenario(){this._isScenarioStarted&&(this._performanceService.endScenario("Wiki","NewWiki.Overview.Load",!0),this._isScenarioStarted=!1)}}}("UtilsWikiPageSwitchTtiLogger"),function(e){Z=t[e]={},t[e].publishWikiPageCommandClicked=function(e,t,i,o,r,s,n){(0,a.publish)(e,t,o,{source:i,pageId:r,mode:s,actionForCurrentPage:n})},t[e].wikiFilteredPageClicked=function(e,t){(0,a.publish)(e,"FilteredPageClicked",t)},t[e].wikiPageFiltered=function(e,t){(0,a.publish)(e,"PageFilterPerformed",t)}}("UtilsWikiTelemetryHelper"),function(e){q=t[e]={};t[e].PageTreeActionCreator=class{constructor(e,t,i,o,r,s,n,d){this._pageContext=e,this._wiki=t,this._version=i,this._source=o,this._overviewActions=r,this._stores=s,this._wikiPageSwitchTtiLogger=n,this._loadHeaderMetadata=d,this.loadTreeIfRequired=()=>{if(!(0,P.isFeatureFlagEnabled)(this._pageContext,"Wiki.DoNotLoadPartialTreeAsync")){const e=this._stores.getState().overviewState.pageInfo;e&&this._stores.getState().treeState.pagesFetchedStatus===j.PagesHierarchyFetchedStatus.None&&this._source.getInitialTreeHierarchy(this._pageContext,this._wiki,this._version,e.path).then((t=>{this._overviewActions.partialPagetreeLoaded.invoke({pagesFetched:t.pages,pathToSelect:e.path})}))}},this.loadAllPages=()=>{if(!this._allPagesLoadPromise){this._allPagesLoadPromise=this._source.getAllPages(this._wiki,this._version);const e=this._stores.getState().overviewState.pageInfo;this._allPagesLoadPromise.then((t=>{this._overviewActions.allPagesFetched.invoke({pagesFetched:t,pathToSelect:e?e.path:void 0})}))}return this._allPagesLoadPromise},this.onPageSelected=(e,t,i,o)=>{this._onPageSelected(e,t,i,o)},this.makePageAsSubPage=(e,t,i,o,r,s)=>{const n=o?o.path:"/",d="/"===n?1:0,p=(0,g.getFileName)(i.path),c=(0,m.combineUrlPaths)(n,p),l=i.path,P=null==r?d:r,v=(0,h.format)(R.MovePageDefaultComment,p,(0,g.getParentPath)(i.path),n);return this._source.movePage(e,t,c,l,P,v).then((t=>(this._overviewActions.onPageMoveCompleted.invoke({sourcePage:i,pageMoveResponse:t}),this._onPageSelected(t.pageMove.page),this.reloadPage(c),(0,a.publish)(this._pageContext,"PageMoved",e.type,{pageId:t.pageMove.page.id}),this.onFilteringDataSetChanged(),t)),(e=>{if(s)throw e;this._onError(e)}))},this.reloadPage=e=>{this._source.getPageWithHierarchy(this._wiki,this._version,e).then((t=>{this._overviewActions.pageHierarchyReloaded.invoke({pagePath:e,flattenedHierarchy:t})}))},this.onPageToggled=(e,t)=>{!t||e.isParentPage&&e.subPages&&e.subPages.length?this._overviewActions.treeItemToggled.invoke({pagePath:e.path,isExpanded:t}):e.isParentPage&&this._source.getPageChildren(this._wiki,this._version,e).then((t=>this._overviewActions.childPagesFetched.invoke({parentPath:e.path,childPages:t})))},this.onFilteringTextChanged=e=>{this._overviewActions.onFilterTextUpdated.invoke(e),this._filter(e)},this.onFilteringComplete=()=>{const e=this._stores.getState().overviewState.pageInfo;this._overviewActions.onFilteringComplete.invoke({lastSelectedPage:e&&e.path})},this.canDrag=e=>(0===this._wiki.type||(0,a.isCodeEditEnabled)(this._pageContext))&&!e.isNonConformant&&"/.templates"!==e.path,this.onDrag=e=>{this._currentDragSource=e},this.onDrop=(e,t,i,o)=>{const r=this._currentDragSource;this._currentDragSource=void 0,r&&(i?this.reorderPage(r,e,o,t):this._confirmMovePage(r,e,0,t))},this.canDrop=(e,t)=>!!this._currentDragSource&&this._isReorderOrReparentPagesAllowed(this._currentDragSource,e,t),this.reorderPage=(e,t,i,o)=>{if(!(e&&t&&e.path&&t.path&&e.path!==t.path))return;const r=(0,g.getParentPath)(e.path),s=(0,g.getParentPath)(t.path);if(r===s)this._makePageAsSibling(e,t,i);else{const r=i?t.order||0:t.order?(0,a.boundedOrderIncrement)(t.order):1,n=this._stores.getState().treeState.treeItemProvider.getItemFromTree(s);this._confirmMovePage(e,n,r,o||!1)}},this.getPagesForFiltering=()=>this._stores.stores.treeStore.getState().pagesFetchedStatus===j.PagesHierarchyFetchedStatus.Complete?Promise.resolve(this._stores.stores.treeStore.getState().treeItemProvider.getAllPages()):this.loadAllPages(),this._onError=e=>{this._overviewActions.onErrorChanged.invoke(e.message)},this._filter=e=>{this._filterProvider.filter(e).then((e=>{(0,Z.wikiPageFiltered)(this._pageContext,this._wiki.type);const t=this._stores.getState().overviewState.pageInfo;this._overviewActions.onFilterResultsUpdated.invoke({filteredPages:e.results,exactMatchedPagesCount:e.exactMatchedPagesCount,currentSelectedPagePath:t&&t.path})}))},this._onPageSelected=(e,t,i,o,r)=>{e?(this._wikiPageSwitchTtiLogger.startScenario(),this._updateUrlIfNeeded(e.path,void 0,"view",!1,i),this._loadHeaderMetadata(e.path),this.onPageToggled(e,!0),e.isNonConformant||(0,B.isFolderAssociatedPage)(e)?(this._overviewActions.pageInfoLoaded.invoke({wikiPageInfo:Object.assign(Object.assign({},e),{version:void 0,content:""}),isSystemAction:r}),e.isNonConformant&&(0,a.publish)(this._pageContext,"NonConformantPageSelected",this._wiki.type,{path:e.path})):(this._overviewActions.pageSelected.invoke({wikiPage:e,anchor:o,updateTree:t,isSystemAction:r}),this._source.getPageInfo(this._wiki,e.path,this._version).then((t=>{const o=this._stores.getState().overviewState.pageInfo;o&&o.path===e.path&&(this._updateUrlIfNeeded(t.path,t.id,"view",!0,i),this._overviewActions.pageInfoLoaded.invoke({wikiPageInfo:t,isSystemAction:r}),(0,B.ingestPageView)(this._pageContext,this._wiki.id,t.id,t.path))}),this._onError))):this._overviewActions.pageSelected.invoke({wikiPage:e,anchor:o,updateTree:t,isSystemAction:r})},this._updateUrlIfNeeded=(e,t,i,o,r)=>{r||(0,a.updateUrl)(this._pageContext,{_a:i,pagePath:e,pageId:t},void 0,1,o)},this._filterProvider=new v.WikiPageFilterProvider(this._pageContext,"overview-tree",this.getPagesForFiltering,this._onError)}onFilteringDataSetChanged(){const e=this._stores.getState().filterState.filterText;e&&this._filter(e)}moveTreeItemOneLevel(e){const t=this._stores.getState();if(t.overviewState.pageInfo){const i=t.overviewState.pageInfo.path;if("/.templates"===i)return;const o=t.treeState.treeItemProvider.getItemFromTree(i);if(o){const i=t.treeState.treeItemProvider.getNextSibling(o.path,e);i&&this.reorderPage(o,i,e)}}}_confirmMovePage(e,t,i,o){let r=t?t.path:"";r+="/"+(0,g.getFileName)(e.path);const a=()=>this.makePageAsSubPage(this._wiki,this._version,e,t,i,!0),s={onConfirm:a,newPagePath:r,oldPagePath:e.path,wiki:this._wiki,wikiVersion:this._version,title:(0,h.format)(R.MovePagePanel_BrokenLinkFixing_Title,(0,g.getFileName)(e.path)),description:(0,h.format)(R.MovePagePanel_BrokenLinkFixing_Description,(0,g.getParentPath)(e.path),(0,g.getParentPath)(r)),successMessage:R.MovePagePanel_BrokenLinkFixing_SuccessMessage,brokenLinksDiscoveryOrRenameFailureMessage:R.MovePagePanel_BrokenLinkFixing_BrokenLinksDiscoveryOrMoveFailureMessage,linksFixFailureMessage:R.MovePagePanel_BrokenLinkFixing_LinksFixFailureMessage,updateButtonText:R.MovePagePanel_MoveButtonText};(0,O.showMoveConfirmationDialogOrPanel)(this._pageContext,s,{onSave:a,wikiType:this._wiki.type},o)}_isReorderOrReparentPagesAllowed(e,t,i){if(this._stores.getState().overviewState.isEditing)return!1;if(!e||e.isNonConformant||!t||t.isNonConformant||e.path===t.path)return!1;const o=(0,h.startsWith)(t.path,e.path+"/"),r=(0,g.getParentPath)(e.path)===t.path;return(i||!r)&&!o}_makePageAsSibling(e,t,i){e.order=e.order||0,t.order=t.order||0;const o=e.order||0;let r=0;if(r=i?e.order>t.order?t.order:t.order-1:e.order>t.order?(0,a.boundedOrderIncrement)(t.order):t.order,r===o)return;this._overviewActions.pageReorderStarted.invoke();const s=e.path;this._source.reorderPage(this._wiki,this._version,s,r).then((t=>{let i,n;r!==t.order&&((0,a.publish)(this._pageContext,"IncompleteOrderFileDetected",this._wiki.type),i=R.IncompleteOrderFileErrorMessage,n=[{text:R.IncompleteOrderFileOpenDocs,href:R.IncompleteOrderFileErrorLink,target:"_blank"}]),this._overviewActions.pageReordered.invoke({pagePath:s,newOrder:t.order,nextPageToSelect:s,oldOrder:o,errorButtonProps:n,errorMessage:i}),this._onPageSelected(e,void 0,void 0,void 0,!0),this.onFilteringDataSetChanged()}),this._onError)}}}("ActionsPageTreeActionCreator"),function(e){K=t[e]={},t[e].c_vcPreviewModeActionId="preview",t[e].openUrlInNewTab=function(e){const t=window.open(e,"_blank");t&&(t.opener=null)},t[e].getExplorerUrl=function(e,t,i,o,r,a){return a||(a={}),r&&(a._a=r),o&&(a.path=o),a.project=t,a["vc.GitRepositoryName"]=i,e.getService("IVssLocationService").routeUrl("ms.vss-code-web.files-route-git",a)}}("UtilsUrlHelper"),function(e){X=t[e]={},t[e].PrintPageClickedEvent="printWikiPageClicked",t[e].NavPaneCollapseThreshold=32;t[e].ActionCreatorsHub=class{constructor(i,o,r,s,n,d,p,c,l,P,m,v){if(this._pageContext=i,this._wiki=o,this._version=r,this._repository=s,this._sources=n,this._overviewActions=d,this._storesHub=p,this._addStoreListener=c,this.onNavPaneResize=i=>{i<=t[e].NavPaneCollapseThreshold?this._overviewActions.navPaneVisibilityChanged.invoke(!0):i<=200?this._overviewActions.navPaneResized.invoke(200):this._overviewActions.navPaneResized.invoke(i)},this.onToggleNavPaneVisibility=()=>{const e=this._storesHub.stores.overviewStore.getState().navPaneState;this._overviewActions.navPaneVisibilityChanged.invoke(!e.isCollapsed)},this.onPageDelete=e=>{this._overviewActions.pageDeleted.invoke({deletedPagePath:e});const t=this._getNextPageToSelect(this._getParentPageOrHomePagePath(e));t?this.onPageSelected(t,!0):this.startEditingZeroDay(),this.treeAC.onFilteringDataSetChanged()},this.startEditingNewPage=(e="")=>{const t=this._storesHub.stores.overviewStore.getState().pageInfo,i=t?(0,g.getParentPath)(t.path):"/",o=this._storesHub.stores.overviewStore.getState().isEditing?"EditMode":"ViewMode";(0,a.publish)(this._pageContext,"NewPageButtonClicked",this._wiki.type,{mode:o}),this._startEditingEmptyPage(i,!1,e)},this.startEditingZeroDay=()=>{this._startEditingEmptyPage("/",!0)},this.addSubPageToCurrentPage=()=>{const e=this._storesHub.getState().overviewState.pageInfo;e&&this.addSubPage(e.path)},this.addSubPage=e=>{this._startEditingEmptyPage(e)},this.startEditingCurrentPage=()=>{const e=this._storesHub.getState().overviewState.pageInfo;e&&this.startEditing(e.path)},this.startEditing=(e,t)=>{this._warnBeforePageSwitch((()=>{const i=this._storesHub.stores.overviewStore.getState().pageInfo,o=i&&e===i.path||!1;this._logPageEditAndStartScenario(!1,o),o?((0,a.isSimpleUrlEnabled)(this._pageContext)?this._updateToPagePathBasedUrlIfNeeded({_a:"edit",pagePath:e,pageId:i&&i.id},t):this._updateUrlIfNeeded({_a:"edit"},void 0,t),this._overviewActions.startEditingCurrentPage.invoke(),this._initializeEditor((0,B.getPageInfoWithName)(i))):this._sources.pageSource.getPageInfo(this._wiki,e,this._version).then((i=>{(0,a.isSimpleUrlEnabled)(this._pageContext)?this._updateToPagePathBasedUrlIfNeeded({_a:"edit",pageId:i.id,pagePath:i.path},t):this._updateUrlIfNeeded({pageId:i.id,pagePath:i.path,_a:"edit"},void 0,t),this._overviewActions.startEditing.invoke(i),this._initializeEditor((0,B.getPageInfoWithName)(i)),this._loadHeaderMetadata(e)}))}),t)},this.redirectToCode=e=>{const t=(0,g.getGitItemPath)(e,this._wiki.mappedPath),i=(0,a.getVersionFromBranchName)(this._version.version),o=(0,K.getExplorerUrl)(this._pageContext,this._repository.project.name,this._repository.name,t,K.c_vcPreviewModeActionId,{version:i});(0,u.onClickFPS)(this._pageContext,o,!0)},this.openInNewTab=e=>{(0,K.openUrlInNewTab)((0,a.getPagePathBasedUrlAndState)(this._pageContext,{pagePath:e},{wikiIdentifier:this._wiki.name,wikiVersion:(0,a.getVersionFromBranchName)(this._version.version)}).url)},this.closeEditor=e=>{this._updateUrlIfNeeded({_a:"view",anchor:void 0},void 0,e),this._overviewActions.closeEditor.invoke(void 0);const t=this._storesHub.stores.overviewStore.getState();t.pageInfo&&(0,B.ingestPageView)(this._pageContext,this._wiki.id,t.pageInfo.id,t.pageInfo.path)},this.onPageSelected=(e,t,i,o,r)=>{const a=this._storesHub.stores.overviewStore.getState();!r&&a.pageInfo&&e&&a.pageInfo.path===e.path?this.treeAC.onPageToggled(e):this._warnBeforePageSwitch((()=>{this._onPageSelected(e,t,i,o)}),i)},this.removeAnchor=e=>{const t=this._storesHub.stores.overviewStore.getState().pageInfo;this._updateUrlIfNeeded({anchor:void 0,pagePath:t&&t.path},void 0,e),this._overviewActions.anchorRemoved.invoke(void 0)},this.onAnchorClicked=(e,t)=>{const i=this._storesHub.stores.overviewStore.getState().pageInfo;this._updateUrlIfNeeded({anchor:e,pagePath:i&&i.path},void 0,t),this._overviewActions.anchorClicked.invoke(e)},this.onFilteredPageSelected=e=>{(0,Z.wikiFilteredPageClicked)(this._pageContext,this._wiki.type),this.onPageSelected(e)},this.updateLinkedWit=e=>{this._overviewActions.linkedWitUpdated.invoke(e)},this.handleEmbedWorkItemFailure=e=>{this._overviewActions.onEmbedWitFailed.invoke({message:e,buttonProps:[{text:R.PageLearnMoreText,ariaLabel:R.CreateAndEmbedWITFailedLearnMoreAriaLabel,href:R.CreateAndEmbedWITLearnMoreLink,target:"_blank"}]})},this.handleEmbedWorkItem=async(e,t,i,o)=>{const r=this._storesHub.stores.overviewStore.getState();if(r.pageInfo){if(void 0===r.pageInfo.version)return Promise.reject();try{const o=h.format(R.CreatedAndEmbeddedWit,i,t);await this._sources.pageSource.createOrUpdatePage(this._wiki,r.pageInfo.path,e,r.pageInfo.version,o,this._version);const s=(0,a.getWikiUrl)(this._pageContext,{pagePath:r.pageInfo.path,pageId:r.pageInfo.id},1);(0,u.FastPageSwitch)(this._pageContext,s,!0)}catch(e){this.handleEmbedWorkItemFailure(o)}}},this.moveDownShortcutPressed=()=>{this.treeAC.moveTreeItemOneLevel(!1)},this.moveUpShortcutPressed=()=>{this.treeAC.moveTreeItemOneLevel(!0)},this.printCurrentPage=()=>{document.body.dispatchEvent(new CustomEvent(t[e].PrintPageClickedEvent,{}))},this.unsetUnfollowPageOption=()=>{this._overviewActions.unsetUnfollowPage.invoke()},this.onFollowStatusRefreshed=()=>{this._overviewActions.refreshFollowStatus.invoke(!1)},this.clearError=()=>{this._overviewActions.onErrorChanged.invoke()},this._startEditingEmptyPage=(e,t=!1,i="")=>{this._warnBeforePageSwitch((()=>{(0,a.setWindowTitle)(this._pageContext,R.WindowTitleForNewPage),this._logPageEditAndStartScenario(!0,!1);const o={pageName:i,pageId:void 0,content:"",version:"",parentPath:e};this._overviewActions.startEditingNewPage.invoke({zeroDay:t,newPageInfo:o}),this._initializeEditor(o,t)}))},this._loadHeaderMetadata=e=>{const t=this._storesHub.stores.overviewStore.getState().pageInfo,i=t&&this._storesHub.getState().treeState.treeItemProvider.getItemFromTree(t.path);if(i&&(i.isNonConformant||(0,B.isFolderAssociatedPage)(i)))return void this._pageMetadatAC.then((e=>{e.clearPageMetadata()}));const o=this._wiki.repositoryId,r=(0,g.getGitItemPath)(e,this._wiki.mappedPath);this._pageMetadatAC.then((t=>{t.fetchPageMetaData(o,this._version,r,e,this._wiki.id)}))},this._loadCommitsData=e=>{const t=this._wiki.repositoryId,i=(0,g.getGitItemPath)(e,this._wiki.mappedPath);this._pageMetadatAC.then((e=>{e.fetchLastCommitData(t,this._version,i)}))},this._onPageSelected=(e,t,i,o)=>{this.treeAC.onPageSelected(e,t,i,o)},this._initializeEditor=(e,t)=>{this._registerEditorFlux(e,t).then((t=>{e&&t.wikiAutoCompleteNwpWrapperModule.translateStorageKeysToDisplayNamesOfPersonMentions(e.content).then((e=>this._overviewActions.contentTranslatedForEditor.invoke(e)))}))},this._getDefaultPageToNavigateTo=()=>{const e=this._storesHub.stores.treeStore.getState().homePagePath;return e?this._storesHub.stores.treeStore.getState().treeItemProvider.getItemFromTree(e):this._storesHub.stores.treeStore.getState().treeItemProvider.getFirstConformantChild("/")},this._updateSavedPage=(e,t)=>{const i=!!this._storesHub.getState().overviewState.tempPageInfo;i&&this._pageMetadatAC.then((e=>{e.clearPageMetadata()})),this._loadCommitsData(e.path);const o=this._storesHub.asyncEditorStore&&this._storesHub.asyncEditorStore.getState().closeEditorAfterSave||!1;!(0,a.isSimpleUrlEnabled)(this._pageContext)||o?(0,a.updateUrl)(this._pageContext,{pageId:e.id,pagePath:e.path,_a:o?"view":"edit",anchor:void 0},void 0,void 0,!0):this._updateToPagePathBasedUrlIfNeeded({pagePath:e.path,pageId:e.id,_a:"edit"},!1);const r=this._storesHub.getState().overviewState.pageInfo,s=i||!r?"":r.path;this._overviewActions.pageSaved.invoke({page:e,pageVersion:t,oldPagePath:s,closeEditor:o}),i?this.treeAC.onFilteringDataSetChanged():s!==e.path&&(this.treeAC.reloadPage(e.path),this.treeAC.onFilteringDataSetChanged())},this._logPageEditAndStartScenario=(e,t)=>{(0,a.publish)(this._pageContext,"PageEditingStarted",this._wiki.type,{isSubPage:e});const i=this._pageContext.getService("IVssPerformanceService"),o={};o.IsFirstTimeLoad=null==this._registerEditorFluxPromise,o.IsNewPage=e,o.requiresFetchingPageData=!e&&!t,i.startScenario("Wiki.Editor.Load",!1,void 0,o)},this._updateUrlIfNeeded=(e,t,i)=>{i||(0,a.updateUrl)(this._pageContext,e,void 0,void 0,t)},this._updateToPagePathBasedUrlIfNeeded=(e,t,i)=>{i||(0,a.updateToPagePathBasedUrlIfNeeded)(this._pageContext,e,{wikiIdentifier:this._wiki.name,wikiVersion:(0,a.getVersionFromBranchName)(this._version.version)},t)},this._treeActionCreator=v||new q.PageTreeActionCreator(this._pageContext,this._wiki,this._version,this._sources.pageSource,this._overviewActions,this._storesHub,P,this._loadHeaderMetadata),"edit"===l.action){const e=this._storesHub.stores.overviewStore.getState().pageInfo;e&&this.startEditing(e.path,!0)}m&&this.startEditingZeroDay()}get treeAC(){return this._treeActionCreator}getEditorAC(){return this._asyncEditorAC}getHeaderMetaDataActionCreator(){return this._asyncPageMetaDataAC}loadHeaderMetadata(){const e=this._storesHub.stores.overviewStore.getState().pageInfo;e&&this._loadHeaderMetadata(e.path)}_warnBeforePageSwitch(e,t){const i=this._storesHub.stores.overviewStore.getState();i.isEditing&&this._asyncEditorAC&&i.pageInfo?this._asyncEditorAC.warnBeforePageSwitch((()=>{this.closeEditor(t),e()}),i.tempPageInfo||(0,B.getPageInfoWithName)(i.pageInfo)):e()}_getParentPageOrHomePagePath(e){const t=(0,g.getParentPath)(e);return"/"!==t?t:this._getHomePagePath()}_getHomePagePath(){}_getNextPageToSelect(e){let t=e;if(!(!!e&&this._canNavigateToPage(e))){const e=this._getDefaultPageToNavigateTo();if(!e||!e.path)return;t=e.path}return t?this._storesHub.getState().treeState.treeItemProvider.getItemFromTree(t):void 0}_canNavigateToPage(e){const t=this._storesHub.stores.treeStore.getState().treeItemProvider.getItemFromTree(e),i="/"!==e,o=!t,r=!(!t||t.isNonConformant)&&!t.isNonConformant;return i&&(o||r)}_registerEditorFlux(e,t){if(this._registerEditorFluxPromise)return this._registerEditorFluxPromise;const i=this._pageContext.getService("IVssContributionService").getContributionAsync("ms.vss-features.markdown-toolbar-table-content").then((()=>this._pageContext.getService("ILegacyPlatformService").requireModules(["Wiki/Scripts/WikiMentionNwpWrapper","Wiki/Scenarios/Overview/Components/WikiToolbar"]))),o=this._pageContext.getService("IVssContributionService").getService("ms.vss-wiki-web.wiki-editor-service");return this._registerEditorFluxPromise=Promise.all([i,o]).then((i=>{const o={wikiAutoCompleteNwpWrapperModule:i[0][0]},r=i[1],{actionCreator:a,store:s,removeActionListeners:n}=r.setupFlux(this.closeEditor,e.content,this._updateSavedPage,e.pageName,o,this._wiki.type,t);return this._asyncEditorAC=a,this._storesHub.registerEditorStore(s,n),this._addStoreListener(s),this._overviewActions.editorModuleLoaded.invoke(void 0),o})),this._registerEditorFluxPromise}get _pageMetadatAC(){return this._asyncPageMetaDataAC?Promise.resolve(this._asyncPageMetaDataAC):this._registerHeaderMetadataFlux()}_registerHeaderMetadataFlux(){return this._pageContext.getService("IVssContributionService").getService("ms.vss-wiki-web.wiki-headermetadata-service").then((e=>{const{actionCreator:t,store:i,removeActionListeners:o}=e.setupFlux();return this._asyncPageMetaDataAC=t,this._storesHub.registerHeaderMetaDataStore(i,o),this._addStoreListener(i),t}))}}}("ActionsActionCreatorsHub"),function(e){Q=t[e]={};const i="edit-page",o="print-page",r={viewRevisions:e=>{const{page:t,pageContext:i,logTelemetry:o,wiki:r,version:a}=e;return{id:"view-revision",text:R.PageRevisionsMenuItemText,onActivate:(e,s)=>{o("ViewPageHistoryButtonClicked"),v(i,r,a,t.path,s)},iconProps:{iconName:"FullHistory"},disabled:t.isNonConformant}},editPage:e=>{const{page:t,actionCreator:o,logTelemetry:r,wikiPermission:a}=e;return{id:i,text:R.EditPageMenuItemText,onActivate:()=>{r("EditButtonClicked"),o.startEditing(t.path)},iconProps:{iconName:"Edit"},disabled:!a.hasWikiContributePermission||t.isNonConformant}},editInRepos:e=>{const{page:t,pageContext:o,actionCreator:r,logTelemetry:a,wikiPermission:s}=e;return{id:i,text:R.EditInReposMenuItemText,onActivate:()=>{a("EditButtonClicked"),r.redirectToCode(t.path)},iconProps:{iconName:"Edit"},disabled:!s.hasWikiContributePermission||!(0,P.isFeatureEnabled)(o,w.RepoServiceContributionId)||t.isNonConformant}},copyPagePath:e=>{const{page:t,pageContext:i,logTelemetry:o}=e;return{id:"copy-page-path",text:R.CopyPagePathMenuItemText,onActivate:()=>{o("CopyPagePathClicked"),(0,B.copyPagePathToClipboard)(i,t.path)},iconProps:{iconName:"Copy"},disabled:t.isNonConformant}},printPage:e=>{const{page:t,pageContext:i,logTelemetry:o,state:r,actionCreator:a}=e;return{id:"print-page",text:R.PrintPageMenuItemText,onActivate:()=>{o("PagePrinted"),a.printCurrentPage()},iconProps:{iconName:"Print"},disabled:r().overviewState.isEditing||!_(r().overviewState.pageInfo,t)||t.isNonConformant||k(i,t.path)}},deletePage:e=>{const{page:t,pageContext:i,actionCreator:o,wiki:r,version:a,logTelemetry:s,wikiPermission:n,state:h}=e;return{id:"delete-page",text:R.DeletePageText,onActivate:()=>{s("DeletePageButtonClicked"),O.showDeletePageDialog(i,{wiki:r,version:a,page:t,onPageDelete:o.onPageDelete})},iconProps:{iconName:"Delete"},disabled:!n.hasWikiContributePermission||h().overviewState.isEditing||t.isNonConformant||k(i,t.path)}},openInNewTab:e=>{const{actionCreator:t,logTelemetry:i,page:o}=e;return{id:"open-in-new-tab",text:R.OpenInNewTabText,onActivate:()=>{i("OpenInNewTabButtonClicked"),t.openInNewTab(o.path)},iconProps:{iconName:"OpenInNewTab"},disabled:o.isNonConformant}},movePage:e=>{const{page:t,wiki:i,version:o,pageContext:r,actionCreator:a,logTelemetry:s,wikiPermission:n,state:h,isHandleBrokenLinksEnabled:d}=e;return{id:"move-page",text:R.MovePageMenuItem,onActivate:()=>{const e=(0,g.getFileName)(t.path),n=h().overviewState.pageInfo;s("MovePagePickerPanelPrompted"),O.showMovePagePanel(r,{wiki:i,version:o,title:e,sourcePage:t,isHandleBrokenLinksEnabled:d,makePageAsSubPage:a.treeAC.makePageAsSubPage,isReorderPagesAllowed:S,homePagePath:h().treeState.homePagePath,selectedPagePath:n&&n.path,getPagesForFiltering:a.treeAC.getPagesForFiltering})},iconProps:{iconName:"PageArrowRight"},disabled:!n.hasWikiContributePermission||h().overviewState.isEditing||t.isNonConformant||k(r,t.path)}},linkWorkItems:e=>{const{page:t,pageContext:i,logTelemetry:o,wiki:r,actionCreator:s,wikiPermission:n,state:h}=e;return{id:"link-work-items",text:R.LinkWitMenuItemText,onActivate:()=>{o("LinkWorkItemsButtonClicked");const e=(0,g.getFileName)(t.path);O.showLinkWorkItemPanel(i,{title:e,wikiId:r.id,wikiPagePath:t.path,wikiType:(0,a.getWikiTypeString)(r.type),onUpdateButtonClick:s.updateLinkedWit,hasWikiContributePermission:n.hasWikiContributePermission})},iconProps:{iconName:"Link"},disabled:h().overviewState.isEditing||t.isNonConformant||(0,g.isInclude)(t.path)}},addSubPage:e=>{const{page:t,pageContext:i,logTelemetry:o,actionCreator:r,wikiPermission:a}=e;return{id:"addSubPage",text:R.AddSubPage,onActivate:()=>{o("AddSubPageButtonClicked"),r.addSubPage(t.path)},iconProps:{iconName:"Add"},disabled:!a.hasWikiContributePermission||t.isNonConformant||k(i,t.path)}}},s=[r.addSubPage,r.copyPagePath,r.movePage,r.editPage,r.deletePage,r.openInNewTab],n=[r.editInRepos,r.openInNewTab],d=[r.printPage,r.linkWorkItems,r.viewRevisions,r.deletePage],p=[r.printPage,r.linkWorkItems,r.viewRevisions,r.deletePage],c=[r.printPage,r.linkWorkItems,r.viewRevisions];function l(e,t,i){return{id:e,items:m(t,i)}}function m(e,t){return e.map(((e,i)=>e(t,i))).filter((e=>e.id!==o||!(0,a.isFirefox)()))}function v(e,t,i,o,r){let s;if(s=(0,a.isSimpleUrlEnabled)(e)?(0,a.getPagePathBasedUrlAndState)(e,{pagePath:o,[w.UrlConstants.ActionParam]:"history"},{wikiIdentifier:t.name,wikiVersion:(0,a.getVersionFromBranchName)(i.version)}).url:(0,a.getWikiUrl)(e,{pagePath:o,[w.UrlConstants.ActionParam]:"history"},1),r&&r.ctrlKey){const e=window.open(s,"_blank");e&&(e.opener=null)}else(0,u.onClickFPS)(e,s,!0,r)}function S(e,t){if(!e||e.isNonConformant||!t||t.isNonConformant||e.path===t.path)return!1;const i=(0,h.startsWith)(t.path,e.path+"/");return!((0,g.getParentPath)(e.path)===t.path)&&!i}function _(e,t){return!!e&&e.path===t.path}function k(e,t){return!(0,a.isIncludeEditingAllowed)(e)&&(0,g.isInclude)(t)}t[e].WikiPageMenuItemsProvider=class{constructor(e,t,i,o,r,h,g){this._pageContext=e,this._wiki=t,this._version=i,this._actionCreator=o,this._getState=r,this._wikiPermission=h,this._isHandleBrokenLinksEnabled=g,this.getTreeMenuItems=e=>{const t="tree-node-menu",i={page:e,actionCreator:this._actionCreator,pageContext:this._pageContext,wiki:this._wiki,version:this._version,logTelemetry:i=>this._logTelemetry(i,t,e.id,_(this._getState().overviewState.pageInfo,e)),state:this._getState,wikiPermission:this._wikiPermission,isHandleBrokenLinksEnabled:this._isHandleBrokenLinksEnabled};return(0,a.isCodeEditEnabled)(this._pageContext)||1!==this._wiki.type?l(t,s,i):l(t,n,i)},this.getHeaderMenuItems=e=>{const t={page:e,actionCreator:this._actionCreator,pageContext:this._pageContext,wiki:this._wiki,version:this._version,logTelemetry:t=>this._logTelemetry(t,"header-menu",e.id,!0),state:this._getState,wikiPermission:this._wikiPermission,isHandleBrokenLinksEnabled:this._isHandleBrokenLinksEnabled};let i=d;1===this._wiki.type&&(i=(0,a.isCodeEditEnabled)(this._pageContext)?p:c);return m(i,t).map((e=>Object.assign(Object.assign({},e),{important:!1})))}}_logTelemetry(e,t,i,o){const r=this._getState().overviewState.isEditing?"EditMode":"ViewMode";(0,Z.publishWikiPageCommandClicked)(this._pageContext,e,t,this._wiki.type,i,r,o)}},t[e]._navigateToPageRevisions=v}("WikiPageMenuItemsProvider"),function(e){J=t[e]={};class i extends _.VssComponent{constructor(e,t){super(e,t),this._updateStateFromStore=()=>{const e=this.props.filterStore.getState().isFilterLoading,t=this.props.filterStore.getState().isFiltering;e==this.state.isLoading&&t==this.state.isFiltering||this.setState({isLoading:e,isFiltering:t})},this.state={},this._isIncludeEditingAllowed=(0,a.isIncludeEditingAllowed)(this.context.pageContext)}componentDidMount(){super.componentDidMount(),this.props.filterStore.addChangedListener(this._updateStateFromStore)}render(){const e=this.props.filterStore.getState();return S.createElement(C.WikiTree,Object.assign({},this.props,{filterTreeItemProvider:e.treeItemProvider,isFilterLoading:e.isFilterLoading,isFiltering:e.isFiltering,additionalColumns:[new k.TreeMoreColumn(this.props.menuItemProvider.getTreeMenuItems,this._isCommandAvailable)],isIncludeEditingAllowed:this._isIncludeEditingAllowed,wikiName:this.props.wikiInfo.wiki.name}))}_isCommandAvailable(e){return!e.isNonConformant&&!(0,B.isFolderAssociatedPage)(e)}}t[e].WikiPageTree=i}("ComponentsWikiPageTree"),function(e){Y=t[e]={};class i extends _.VssComponent{render(){const e=this.props.treeState.pagesFetchedStatus===j.PagesHierarchyFetchedStatus.None;return S.createElement(S.Fragment,null,S.createElement("div",{className:(0,f.css)("flex-column wiki-picker-ctr flex-noshrink",(0,a.isCodeWiki)(this.props.wikiInfo.wiki)?"code-wiki":"project-wiki")},S.createElement(_.WrappedComponent,{dependencies:["ms.vss-wiki-web.wiki-picker-content"],wrappedType:"wiki-picker",wikiInfo:this.props.wikiInfo,showPublishCodeWikiAction:this.props.showPublishCodeWikiAction,showCreateNewProjectWikiAction:this.props.showCreateNewProjectWikiAction,loadingComponent:()=>S.createElement(S.Fragment,null,S.createElement("div",{className:"shimmer shimmer-line",style:{height:"32px",margin:"16px 12px 0px 12px"}}),(0,a.isCodeWiki)(this.props.wikiInfo.wiki)&&S.createElement("div",{className:"shimmer shimmer-line",style:{height:"32px",margin:"8px 12px 0px 12px"}}))})),e?S.createElement(o,null):S.createElement(J.WikiPageTree,Object.assign({},this.props,{itemProvider:this.props.treeState.treeItemProvider,homePagePath:this.props.treeState.homePagePath})))}}t[e].NavigationPane=i;const o=()=>{let e=[];for(let t=0;t<7;t++)e.push(S.createElement("div",{className:"flex-row",key:"loading-row-"+t},S.createElement("div",{className:"shimmer shimmer-circle-small  tree-shimmer-circle"}),S.createElement("div",{className:"shimmer shimmer-line tree-shimmer-line",style:{width:80*Math.random()+15+"%"}})));return S.createElement("div",null,S.createElement("div",{className:"shimmer shimmer-line tree-filter-shimmer"}),S.createElement("div",null,e))}}("ComponentsNavigationPane"),function(e){$=t[e]={};const i="header-menu";class o extends _.VssComponent{render(){return S.createElement("div",{className:"wiki-content-header"},this.props.page&&S.createElement(S.Fragment,null,S.createElement(b.CustomHeader,{className:"wiki-header-component"},S.createElement(b.HeaderTitleArea,null,S.createElement(b.HeaderTitleRow,null,S.createElement(r,{className:"text-ellipsis"},(0,g.getFileName)(this.props.pagePath)))),S.createElement("div",{className:"flex-row flex-noshrink"},this.props.page&&this.props.page.id&&S.createElement(_.WrappedComponent,{wrappedType:"Wiki.FollowComponent",dependencies:["ms.vss-wiki-web.wiki-page-follow"],pageId:this.props.page.id,wikiId:this.props.wiki.id,projectId:this.props.wiki.projectId,unfollowPage:this.props.unfollowPage,unsetUnfollowPageOption:this.props.unsetUnfollowPageOption,refreshFollowStatus:this.props.refreshFollowStatus,onFollowStatusRefreshed:this.props.onFollowStatusRefreshed}),this._onRenderEditElement(),S.createElement(E.HeaderCommandBar,{className:"wiki-header-command-bar",items:this.props.menuItemProvider.getHeaderMenuItems(this.props.page)}))),this.props.page.isNonConformant?S.createElement(A.MessageCard,{severity:"Warning",className:"wiki-message-card",buttonProps:[{text:R.PageLearnMoreText,href:R.NonConformancePageLearnMoreLink,target:"_blank"}]},R.NonConformantPageError):this.props.headerMetaDataState&&S.createElement(b.HeaderDescription,null,S.createElement(_.WrappedComponent,Object.assign({wrappedType:"Wiki.OverviewMetaDataHeader",dependencies:["ms.vss-wiki-web.wiki-headermetadata-content"]},this.props)))))}_onRenderEditElement(){const e="wh-edit-btn",t=this.props.page;if(t){if((0,a.isCodeWiki)(this.props.wiki)){const i=!this.props.hasWikiContributePermission||t.isNonConformant,o=!(0,P.isFeatureEnabled)(this.context.pageContext,w.RepoServiceContributionId);return(0,a.isCodeEditEnabled)(this.context.pageContext)?S.createElement(x.SplitButton,{className:e,disabled:i,buttonProps:{text:R.EditPageMenuItemText,onClick:()=>{this._editPageAndPublishTelemetry(t)}},menuButtonProps:{ariaLabel:R.MoreEditOptions_Label,contextualMenuProps:{menuProps:{id:"wh-edit-menu",items:[{id:"edit-in-repos",text:R.EditInReposMenuItemText,iconProps:{iconName:"Edit"},onActivate:()=>{this._editInReposAndPublishTelemetry(t)},disabled:o}]}}}}):S.createElement(I.Button,{className:e,text:R.EditInReposMenuItemText,disabled:i,onClick:()=>{this._editInReposAndPublishTelemetry(t)}})}return S.createElement(I.Button,{className:e,text:R.EditPageMenuItemText,disabled:!this.props.hasWikiContributePermission||t.isNonConformant,onClick:()=>{this._editPageAndPublishTelemetry(t)}})}return null}_editPageAndPublishTelemetry(e){(0,Z.publishWikiPageCommandClicked)(this.context.pageContext,"EditButtonClicked",i,this.props.wiki.type,e.id,"ViewMode",!0),this.props.editCurrentPage()}_editInReposAndPublishTelemetry(e){(0,Z.publishWikiPageCommandClicked)(this.context.pageContext,"EditInReposButtonClicked",i,this.props.wiki.type,e.id,"ViewMode",!0),this.props.redirectToCode(e.path)}}function r(e){return S.createElement("div",{"aria-level":1,className:(0,f.css)(e.className,"wiki-header-title title-l"),role:"heading"},e.children)}t[e].WikiHeader=o}("ComponentsWikiHeader"),function(e){ee=t[e]={};const i="wiki-print-frame",o="wiki-view-container";class r extends _.VssComponent{constructor(e,t){super(e,t),this._onInitialRender=()=>{if(this.props.wikiPageSwitchTtiLogger.endScenario(),this.props.overviewState.pageInfo){const t={},i=function(e){const t=new RegExp(":::[\\s]*query-table[\\s]+([\\S]+)[\\s]*:::","ig");let i;const o=[];for(;i=t.exec(e);)o.push(i[1]);return o}(this.props.overviewState.pageInfo.content);i&&i.length>0&&(t.WitQueryIds=i),e=this.props.overviewState.pageInfo.content,new RegExp(":::[\\s]*mermaid[\\s\\r\\n]+[\\S]+[\\s\\S]*:::").test(e)&&(t.hasMermaidDiagram=!0),(0,a.publish)(this.context.pageContext,"PageViewed",this.props.wikiInfo.wiki.type,Object.assign({pageId:this.props.overviewState.pageInfo.id,wikiId:this.props.wikiInfo.wiki.id},t))}var e},this._onRenderFarElement=()=>{const{actionCreatorHub:e,headerMetaDataState:t,overviewState:i,treeState:o,wikiInfo:r}=this.props;if(i.isEditing)return S.createElement(S.Fragment,null,i.isEditorModuleLoaded&&this.props.editorState&&null!=this.props.editorState.pageContent?S.createElement(_.WrappedComponent,{dependencies:["ms.vss-wiki-web.wiki-editor-content"],wrappedType:"wiki-editor",actionCreator:e.getEditorAC(),editorState:this.props.editorState,wikiInfo:r,pageInfo:i.tempPageInfo||i.pageInfo&&(0,B.getPageInfoWithName)(i.pageInfo),wikiPages:(0,P.isFeatureFlagEnabled)(this.context.pageContext,"Wiki.TableOfSubPages",!1)?o.treeItemProvider.getAllPages():[],anchor:i.anchor,onAnchorClick:e.onAnchorClicked,getWikiPage:o.pagesFetchedStatus===j.PagesHierarchyFetchedStatus.Complete?o.treeItemProvider.getWikiPageForPagePathIgnoreCase:void 0,getPagesForFiltering:e.treeAC.getPagesForFiltering,isHandleBrokenLinksEnabled:this.props.isHandleBrokenLinksEnabled}):S.createElement(y.Spinner,{className:"wiki-editor-spinner"}));if(i.pageInfo){const p=i.pageInfo.path;if(d=this.context.pageContext,"/.templates"===i.pageInfo.path&&(0,a.isIncludeEditingAllowed)(d)){const t=this._getBaseZeroDataParams(R.IncludesPrimaryMessage,n("includes-folder.svg"));return this._onRenderZeroDataComponent(Object.assign(Object.assign({},t),{secondaryText:R.IncludesSecondaryMessage,actionText:R.AddIncludeText,actionType:0,onActionClick:()=>e.addSubPage("/.templates")}))}if((0,B.isFolderAssociatedPage)(i.pageInfo)){const t=(0,g.getFileName)(p),i=this._getBaseZeroDataParams(h.format(R.IsAFolder,t),n("is-a-folder.svg"));return this._onRenderZeroDataComponent(Object.assign(Object.assign({},i),{actionText:R.AddPageContent,actionType:0,onActionClick:()=>e.startEditingNewPage(t)}))}return S.createElement(s,{projectId:r.wikiRepositoryData.repository.project.id,repositoryId:r.wikiRepositoryData.repository.id,wiki:r.wiki,wikiVersion:r.wikiVersion,page:i.pageInfo,onUpdateLinkWitClick:e.updateLinkedWit,headerMetaDataState:t,anchor:i.anchor,onAnchorClick:e.onAnchorClicked,getWikiPage:o.pagesFetchedStatus===j.PagesHierarchyFetchedStatus.Complete?o.treeItemProvider.getWikiPageForPagePathIgnoreCase:void 0,menuItemProvider:this.props.menuItemProvider,hasWikiContributePermission:r.wikiPermissions.hasWikiContributePermission,content:i.pageInfo.content,onInitialRender:this._onInitialRender,isLoading:i.isPageInfoLoading,printFrame:this._printIframeId,unfollowPage:i.isPageUnfollow,unsetUnfollowPageOption:e.unsetUnfollowPageOption,refreshFollowStatus:i.refreshFollowStatus,onFollowStatusRefreshed:e.onFollowStatusRefreshed,handleEmbedWorkItem:e.handleEmbedWorkItem,handleEmbedWorkItemFailure:e.handleEmbedWorkItemFailure,AddNewPage:this.props.actionCreatorHub.startEditingNewPage,EditCurrentPage:this.props.actionCreatorHub.startEditingCurrentPage,AddSubPageToCurrent:this.props.actionCreatorHub.addSubPageToCurrentPage,TreeMoveDownOneLevel:this.props.actionCreatorHub.moveDownShortcutPressed,TreeMoveUpOneLevel:this.props.actionCreatorHub.moveUpShortcutPressed,clearError:e.clearError,errorState:i.errorState,PrintCurrentPage:this.props.actionCreatorHub.printCurrentPage,isPageCommentsReadOnly:this.props.isPageCommentsReadOnly,redirectToCode:e.redirectToCode,wikiPages:(0,P.isFeatureFlagEnabled)(this.context.pageContext,"Wiki.TableOfSubPages",!1)?o.treeItemProvider.getAllPages():[]})}return this._onRenderZeroDataComponent(this._getBaseZeroDataParams(R.PageNotFound,n("page-not-found.svg")));var d},this._getBaseZeroDataParams=(e,t)=>({primaryText:e,imagePath:(0,T.getAssetLocation)(this.context.pageContext,t),imageAltText:""}),this._onRenderZeroDataComponent=e=>S.createElement("div",{className:"wiki-zerodata flex-column justify-center"},S.createElement(N.ZeroData,Object.assign({},e))),this._onRenderNearElement=()=>{const{isCollapsed:e}=this.props.overviewState.navPaneState;let t,i,o;e?(t="DoubleChevronRight",i="hidden",o=R.ShowMoreNavPane):(t="DoubleChevronLeft",i=void 0,o=R.ShowLessNavPane);const r={canDrag:this.props.actionCreatorHub.treeAC.canDrag,canDrop:this.props.actionCreatorHub.treeAC.canDrop,onDrag:this.props.actionCreatorHub.treeAC.onDrag,onDrop:this.props.actionCreatorHub.treeAC.onDrop};return S.createElement("div",{className:"flex-column flex-grow",role:"navigation","aria-label":R.WikiOverview},S.createElement("div",{className:(0,f.css)("wiki-nav-bg flex-column flex-grow relative",i)},S.createElement(Y.NavigationPane,{wikiInfo:this.props.wikiInfo,showCreateNewProjectWikiAction:this.props.showCreateNewProjectWikiAction,showPublishCodeWikiAction:this.props.showPublishCodeWikiAction,treeState:this.props.treeState,onPageSelected:this.props.actionCreatorHub.onPageSelected,onFilteredPageSelected:this.props.actionCreatorHub.onFilteredPageSelected,onPageToggled:this.props.actionCreatorHub.treeAC.onPageToggled,onFilterChanged:this.props.actionCreatorHub.treeAC.onFilteringTextChanged,onFilteringComplete:this.props.actionCreatorHub.treeAC.onFilteringComplete,filterStore:this.props.filterStore,menuItemProvider:this.props.menuItemProvider,wikiTreeDragDropProps:r,isReorderInProgress:this.props.treeState.isReorderInProgress,selectedPagePath:this.props.overviewState.pageInfo&&this.props.overviewState.pageInfo.path,isHandleBrokenLinksEnabled:this.props.isHandleBrokenLinksEnabled,openInNewTab:this.props.actionCreatorHub.openInNewTab})),S.createElement("div",{className:(0,f.css)("wiki-expander flex-grow",!e&&"hidden"),onClick:this._onChevronClick}),S.createElement("div",{className:(0,f.css)("wiki-collapse-section flex-row flex-noshrink")},S.createElement(I.Button,{className:(0,f.css)("wiki-newpage-button flex-grow",i),iconProps:{iconName:"Add"},subtle:!0,onClick:()=>this.props.actionCreatorHub.startEditingNewPage(),text:R.NewPageActionButton,disabled:!this.props.wikiInfo.wikiPermissions.hasWikiContributePermission||(0,a.isCodeWiki)(this.props.wikiInfo.wiki)&&!(0,a.isCodeEditEnabled)(this.context.pageContext)}),S.createElement(W.Tooltip,{text:o},S.createElement("div",{"aria-label":o,className:"focus-treatment wiki-collapse-icon-effect fontSize flex-row",onClick:this._onChevronClick,onKeyDown:this._onChevronKeyDown,role:"button",tabIndex:0},S.createElement(L.Icon,{className:(0,f.css)("wiki-collapse-icon flex-row flex-center flex-noshrink justify-center cursor-pointer",e?"collapsed":"expanded"),iconName:t})))))},this._onChevronKeyDown=e=>{e.defaultPrevented||32!==e.which&&13!==e.which||(this._onChevronClick(),e.preventDefault())},this._onChevronClick=()=>{this.props.actionCreatorHub.onToggleNavPaneVisibility()},this._printIframeId=(0,F.getId)(i)}componentDidMount(){super.componentDidMount(),this.props.overviewState.pageInfo?(0,B.ingestPageView)(this.context.pageContext,this.props.wikiInfo.wiki.id,this.props.overviewState.pageInfo.id,this.props.overviewState.pageInfo.path):(0,a.publish)(this.context.pageContext,"BrokenLinkErrorPageVisited",this.props.wikiInfo.wiki.type)}render(){const{isCollapsed:e,currentSize:t}=this.props.overviewState.navPaneState;return S.createElement("div",{className:"wiki-overview flex-grow flex-column"},S.createElement("iframe",{className:i,id:this._printIframeId,width:"0%",height:"0%",hidden:!0}),S.createElement(M.Splitter,{ariaLabel:R.SeparatorAriaLabel,fixedSize:e?X.NavPaneCollapseThreshold:t,fixedElement:0,splitterDirection:0,onRenderFarElement:this._onRenderFarElement,onRenderNearElement:this._onRenderNearElement,onFixedSizeChanged:this.props.actionCreatorHub.onNavPaneResize,nearElementClassName:(0,f.css)("wiki-left-pane flex-column flex-grow",e&&"justify-end wiki-nav-bg"),farElementClassName:"relative"}))}}t[e].Overview=r;class s extends _.VssComponent{constructor(){super(...arguments),this._markdownRendererRef=S.createRef(),this._registerShortcuts=e=>{const t=this.context.pageContext.getService("IVssKeyboardShortcutService");e&&(t.registerShortcut(R.ViewShortcutGroupHeading,{combos:["n"],description:R.PageShortcut_Add,action:()=>this.props.AddNewPage()}),t.registerShortcut(R.ViewShortcutGroupHeading,{combos:["e"],description:R.PageShortcut_Edit,action:this.props.EditCurrentPage}),t.registerShortcut(R.ViewShortcutGroupHeading,{combos:["c"],description:R.PageShortcut_AddSubPage,action:this.props.AddSubPageToCurrent}),t.registerShortcut(R.ViewShortcutGroupHeading,{combos:["mod+down"],description:R.TreeShortcut_MoveDown,action:this.props.TreeMoveDownOneLevel}),t.registerShortcut(R.ViewShortcutGroupHeading,{combos:["mod+up"],description:R.TreeShortcut_MoveUp,action:this.props.TreeMoveUpOneLevel})),t.registerShortcut(R.ViewShortcutGroupHeading,{combos:["mod+p"],description:R.PageShortcut_Print,action:this.props.PrintCurrentPage})},this._populateFrameAndPrint=()=>{const{headerMetaDataState:e}=this.props;if(e){let t="";if(this._markdownRendererRef.current){const e=this._markdownRendererRef.current.getRenderedContent();e&&(t=e)}const i=this.context.pageContext.getService("IVssContributionService");this.trackPromise(i.getService("ms.vss-wiki-web.wiki-printpage-service")).promise.then((i=>{i&&this.props.page&&i.populateFrameAndPrint(this.props.printFrame,(0,g.getFileName)(this.props.page.path),e,t)}))}}}componentDidMount(){super.componentDidMount(),this._registerShortcuts(!!this.props.hasWikiContributePermission),this.addEventListener(document.body,X.PrintPageClickedEvent,this._populateFrameAndPrint)}componentWillUnmount(){super.componentWillUnmount();this.context.pageContext.getService("IVssKeyboardShortcutService").removeShortcutGroup(R.ViewShortcutGroupHeading)}render(){return S.createElement("div",{className:(0,f.css)("absolute-fill scroll-auto flex-column",o)},this.props.errorState&&this.props.errorState.message&&S.createElement(A.MessageCard,{severity:"Error",onDismiss:this.props.clearError,className:"flex-noshrink",buttonProps:this.props.errorState.buttonProps},this.props.errorState.message),S.createElement($.WikiHeader,{headerMetaDataState:this.props.headerMetaDataState,onUpdateLinkWitClick:this.props.onUpdateLinkWitClick,wiki:this.props.wiki,page:this.props.page,menuItemProvider:this.props.menuItemProvider,hasWikiContributePermission:this.props.hasWikiContributePermission,unfollowPage:this.props.unfollowPage,refreshFollowStatus:this.props.refreshFollowStatus,onFollowStatusRefreshed:this.props.onFollowStatusRefreshed,unsetUnfollowPageOption:this.props.unsetUnfollowPageOption,pagePath:this.props.page.path,editCurrentPage:this.props.EditCurrentPage,redirectToCode:this.props.redirectToCode}),this.props.isLoading?S.createElement(y.Spinner,null):S.createElement("div",null,S.createElement(H.WikiMarkdownRenderer,{wiki:this.props.wiki,wikiVersion:this.props.wikiVersion,wikiPages:this.props.wikiPages,projectId:this.props.projectId,repositoryId:this.props.repositoryId,content:this.props.content,anchor:this.props.anchor,onAnchorClick:this.props.onAnchorClick,getWikiPage:this.props.getWikiPage,onInitialRender:this.props.onInitialRender,ref:this._markdownRendererRef,pagePath:this.props.page.path,pageId:this.props.page.id,scrollToElementClassName:o,handleEmbedWorkItem:!this.props.hasWikiContributePermission||(0,a.isCodeWiki)(this.props.wiki)&&!(0,a.isCodeEditEnabled)(this.context.pageContext)?void 0:this.props.handleEmbedWorkItem,handleEmbedWorkItemFailure:this.props.handleEmbedWorkItemFailure}),this.props.page.id&&((0,P.isFeatureFlagEnabled)(this.context.pageContext,w.WikiPageCommentsFF)||(0,P.isFeatureFlagEnabled)(this.context.pageContext,"Wiki.PageViewsUX"))&&S.createElement("hr",{className:"wiki-metadata-separator"}),this.props.page.id&&(0,P.isFeatureFlagEnabled)(this.context.pageContext,"Wiki.PageViewsUX")&&S.createElement(_.WrappedComponent,{dependencies:["ms.vss-wiki-web.wiki-page-views-content"],wrappedType:"Wiki.WikiPageViews",wikiId:this.props.wiki.id,projectId:this.props.wiki.projectId,pageId:this.props.page.id}),this.props.page.id&&(0,P.isFeatureFlagEnabled)(this.context.pageContext,w.WikiPageCommentsFF)&&S.createElement(_.WrappedComponent,{dependencies:["ms.vss-wiki-web.wiki-page-comments"],wrappedType:"wiki-pagecomments",wikiArtifact:{wikiId:this.props.wiki.id,projectId:this.props.wiki.projectId,pageId:this.props.page.id},isReadOnly:this.props.isPageCommentsReadOnly})))}}function n(e){return"ms.vss-wiki-web/wiki-overview-content/Images/"+e}}("ComponentsOverview"),function(e){t[e]={};class i extends _.VssComponent{constructor(e,t){super(e,t),this._addStoreListener=e=>{e.addChangedListener(this._updateStateFromStore)},this._updateStateFromStore=()=>{this._publishLandedOnWikiHubTelemetry&&((0,a.publish)(this.context.pageContext,"LandedOnWiki",this.props.wikiInfo.wiki.type,{isHomePage:this.state.treeState.homePagePath===(this.state.overviewState.pageInfo&&this.state.overviewState.pageInfo.path)}),this._publishLandedOnWikiHubTelemetry=!1),this.setState({overviewState:this._storesHub.stores.overviewStore.getState(),editorState:this._storesHub.asyncEditorStore&&this._storesHub.asyncEditorStore.getState(),treeState:this._storesHub.stores.treeStore.getState(),headerMetaDataState:this._storesHub.asyncHeaderMetaDataStore&&this._storesHub.asyncHeaderMetaDataStore.getState()})};const i=new z.OverviewActions;this._storesHub=new z.StoresHub({overviewStore:new V.OverviewStore(this.props.wikiViewOptions,this.props.wikiPageInfo),treeStore:new j.WikiTreeStore(this.props.isInitialTreeDataPopulated,this.props.wikiPages,this.props.wikiPageInfo&&this.props.wikiPageInfo.path),filterStore:new D.FilterTreeStore},i),this._publishLandedOnWikiHubTelemetry=!0,this._wikiPageSwitchTtiLogger=new G.WikiPageSwitchTtiLogger(this.context.pageContext),this._actionsCreatorHub=new X.ActionCreatorsHub(this.context.pageContext,this.props.wikiInfo.wiki,this.props.wikiInfo.wikiVersion,this.props.wikiInfo.wikiRepositoryData.repository,{pageSource:new U.WikiPageSource(this.context.pageContext)},i,this._storesHub,this._addStoreListener,this.props.wikiViewOptions,this._wikiPageSwitchTtiLogger,this.props.isEmptyWiki),this.state={overviewState:this._storesHub.stores.overviewStore.getState(),editorState:void 0,treeState:this._storesHub.stores.treeStore.getState(),headerMetaDataState:void 0},this._menuProvider=new Q.WikiPageMenuItemsProvider(this.context.pageContext,this.props.wikiInfo.wiki,this.props.wikiInfo.wikiVersion,this._actionsCreatorHub,this._storesHub.getState,this.props.wikiInfo.wikiPermissions,this.props.isHandleBrokenLinksEnabled)}componentDidMount(){super.componentDidMount();this.context.pageContext.getService("IVssPerformanceService").markTimeToInteractive("Wiki","NewWiki.Overview.Load",void 0,{isFirstRender:!0}),this._storesHub.stores.overviewStore.addChangedListener(this._updateStateFromStore),this._storesHub.stores.treeStore.addChangedListener(this._updateStateFromStore),this._actionsCreatorHub.loadHeaderMetadata(),this._actionsCreatorHub.treeAC.loadTreeIfRequired()}componentWillUnmount(){super.componentWillUnmount(),this._storesHub.stores.overviewStore.removeChangedListener(this._updateStateFromStore),this._storesHub.stores.treeStore.removeChangedListener(this._updateStateFromStore),this._storesHub.asyncEditorStore&&this._storesHub.asyncEditorStore.removeChangedListener(this._updateStateFromStore),this._storesHub.asyncHeaderMetaDataStore&&this._storesHub.asyncHeaderMetaDataStore.removeChangedListener(this._updateStateFromStore),this._storesHub.removeActionListeners()}componentDidUpdate(e,t){if(super.componentDidUpdate(e,t),!(0,F.shallowCompare)(e,this.props)){const e=this.props.wikiViewOptions.action||"view",{pageInfo:t,anchor:i,isEditing:o}=this._storesHub.stores.overviewStore.getState(),r=o?"edit":"view";if((0,F.shallowCompare)({pagePath:t&&t.path,id:t&&t.id,action:r},{pagePath:this.props.wikiPageInfo&&this.props.wikiPageInfo.path,id:this.props.wikiPageInfo&&this.props.wikiPageInfo.id,action:e}))(0,h.equals)(this.props.wikiViewOptions.anchor||"",i||"")||(this.props.wikiViewOptions.anchor?this._actionsCreatorHub.onAnchorClicked(this.props.wikiViewOptions.anchor,!0):this._actionsCreatorHub.removeAnchor(!0));else if((0,h.equals)(e,"view")){if(this.props.wikiPageInfo){let e;this.props.wikiPageInfo.path&&(e={path:this.props.wikiPageInfo.path,id:this.props.wikiPageInfo.id}),this._actionsCreatorHub.onPageSelected(e,!0,!0,this.props.wikiViewOptions.anchor,!0)}}else(0,h.equals)(e,"edit")&&this.props.wikiPageInfo&&this._actionsCreatorHub.startEditing(this.props.wikiPageInfo.path,!0)}}render(){return S.createElement(ee.Overview,{editorState:this.state.editorState,overviewState:this.state.overviewState,wikiInfo:this.props.wikiInfo,showCreateNewProjectWikiAction:this.props.showCreateNewProjectWikiAction,showPublishCodeWikiAction:this.props.showPublishCodeWikiAction,actionCreatorHub:this._actionsCreatorHub,treeState:this.state.treeState,filterStore:this._storesHub.stores.filterStore,headerMetaDataState:this.state.headerMetaDataState,menuItemProvider:this._menuProvider,isHandleBrokenLinksEnabled:this.props.isHandleBrokenLinksEnabled,wikiPageSwitchTtiLogger:this._wikiPageSwitchTtiLogger,isPageCommentsReadOnly:this.props.isPageCommentsReadOnly})}}t[e].OverviewContainer=i}("ComponentsOverviewContainer")}),["Resources","OverviewDialogHandler","Sources/WikiPageSource","Stores/OverviewStore","Utils/WikiHelper","Stores/WikiTreeStore","Stores/StoresHub","Utils/WikiPageSwitchTtiLogger","Utils/WikiTelemetryHelper","Actions/PageTreeActionCreator","Utils/UrlHelper","Actions/ActionCreatorsHub","WikiPageMenuItemsProvider","Components/WikiPageTree","Components/NavigationPane","Components/WikiHeader","Components/Overview","Components/OverviewContainer"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-wiki-web.wiki-overview-content"}}));